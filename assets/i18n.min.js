class I18nManager{constructor(){this.messages={},this.uiMessages={},this.blocklyMessages={},this.currentLanguage="ko",this.supportedLanguages=["ko","en","es","zh","ja","fr","de","ru","tr","vi","pt","uz","ar","fa","fil","hi","id","it","nl","th","zh-tw","sv","pl"],this.languageInfo={ko:{name:"Korean",nativeName:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},en:{name:"English",nativeName:"English",flag:"ðŸ‡ºðŸ‡¸"},es:{name:"Spanish",nativeName:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},zh:{name:"Chinese",nativeName:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},ja:{name:"Japanese",nativeName:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},fr:{name:"French",nativeName:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},de:{name:"German",nativeName:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},ru:{name:"Russian",nativeName:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},tr:{name:"Turkish",nativeName:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},vi:{name:"Vietnamese",nativeName:"Tiáº¿ng Viá»‡t",flag:"ðŸ‡»ðŸ‡³"},pt:{name:"Portuguese (Brazil)",nativeName:"PortuguÃªs (Brasil)",flag:"ðŸ‡§ðŸ‡·"},uz:{name:"Ozbek tili",nativeName:'O"zbek tili',flag:"uz"},ar:{name:"Arabic",nativeName:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},fa:{name:"Persian",nativeName:"ÙØ§Ø±Ø³ÛŒ",flag:"ðŸ‡®ðŸ‡·"},fil:{name:"Filipino",nativeName:"Filipino",flag:"ðŸ‡µðŸ‡­"},hi:{name:"Hindi",nativeName:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},id:{name:"Indonesian",nativeName:"Bahasa Indonesia",flag:"ðŸ‡®ðŸ‡©"},it:{name:"Italian",nativeName:"Italiano",flag:"ðŸ‡®ðŸ‡¹"},nl:{name:"Dutch",nativeName:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},th:{name:"Thai",nativeName:"à¹„à¸—à¸¢",flag:"ðŸ‡¹ðŸ‡­"},"zh-tw":{name:"Chinese (Traditional)",nativeName:"ç¹é«”ä¸­æ–‡",flag:"ðŸ‡¹ðŸ‡¼"},sv:{name:"Swedish",nativeName:"Svenska",flag:"ðŸ‡¸ðŸ‡ª"},pl:{name:"Polish",nativeName:"Polski",flag:"ðŸ‡µðŸ‡±"}},this.stats={languageUsage:{}}}async loadUITranslation(e){try{const a=await fetch(`./translations/ui_i18n/ui_${e}.json`);if(!a.ok)throw new Error(`UI translation file not found: ui_${e}.json`);const t=await a.json();return this.uiMessages=t,{success:!0}}catch(e){return console.warn(`âŒ UI ë²ˆì—­ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${e.message}`),{success:!1,error:e.message}}}async loadBlocklyTranslation(e){try{const a=await fetch(`./translations/blockly_core/blockly_${e}.json`);if(!a.ok)throw new Error(`Blockly translation file not found: blockly_${e}.json`);const t=await a.json();return this.blocklyMessages=t,{success:!0}}catch(e){return console.warn(`âŒ Blockly ë²ˆì—­ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${e.message}`),{success:!1,error:e.message}}}mergeTranslations(){this.messages={...this.blocklyMessages,...this.uiMessages},this.detectKeyConflicts(),this.applyToBlocklyMsg()}applyToBlocklyMsg(){if("undefined"!=typeof Blockly&&Blockly.Msg)for(const e in this.messages)e.startsWith("BKY_")&&(Blockly.Msg[e]=this.messages[e])}detectKeyConflicts(){const e=Object.keys(this.blocklyMessages),a=Object.keys(this.uiMessages);e.filter(e=>a.includes(e)).length}async loadTranslations(e=null){const a=e||this.detectBrowserLanguage();try{if(this.supportedLanguages.includes(a)){const[e,t]=await Promise.all([this.loadUITranslation(a),this.loadBlocklyTranslation(a)]);if(e.success&&t.success)return this.mergeTranslations(),this.currentLanguage=a,this.recordLanguageUsage(a),!0;throw new Error(`ì¼ë¶€ ë²ˆì—­ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${a}`)}return console.warn(`ðŸ”„ ${a}ì€ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´ìž…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.`),await this.loadTranslations("ko")}catch(e){return console.error(`âŒ ë²ˆì—­ ì‹œìŠ¤í…œ ì˜¤ë¥˜: ${e.message}`),"ko"!==a&&(console.log(`ðŸš¨ ${a} ë¡œë“œ ì‹¤íŒ¨, í•œêµ­ì–´ë¡œ í´ë°±`),await this.loadTranslations("ko"))}}getMessage(e,a=e){return this.messages["BKY_"+e]||this.messages[e]||a}getUIMessage(e,a=e){return this.uiMessages[e]||a}getBlocklyMessage(e,a=e){return this.blocklyMessages[e]||this.blocklyMessages["BKY_"+e]||a}getCurrentLanguage(){return this.currentLanguage}isNativeLanguage(){return this.supportedLanguages.includes(this.currentLanguage)}getAllSupportedLanguages(){return[...this.supportedLanguages]}async changeLanguage(e){return!!this.supportedLanguages.includes(e)&&await this.loadTranslations(e)}detectBrowserLanguage(){const e=navigator.languages||[navigator.language||"ko"];for(let a of e){const e=a.toLowerCase();if("zh-tw"===e&&this.supportedLanguages.includes("zh-tw"))return"zh-tw";if("zh-cn"===e&&this.supportedLanguages.includes("zh"))return"zh";if("en-us"===e&&this.supportedLanguages.includes("en"))return"en";const t=e.replace("-","-");if(this.supportedLanguages.includes(t))return t}for(let a of e){const e=a.split("-")[0].toLowerCase();if(this.supportedLanguages.includes(e))return e}return"ko"}generateLanguageOptions(){return this.supportedLanguages.map(e=>{const a=this.languageInfo[e];return a?{value:e,text:a.nativeName,type:"native"}:null}).filter(Boolean)}isRTLLanguage(e=this.currentLanguage){return["ar","he","fa","ur"].includes(e)}recordLanguageUsage(e){this.stats.languageUsage[e]=(this.stats.languageUsage[e]||0)+1;try{localStorage.setItem("i18n_stats",JSON.stringify(this.stats))}catch(e){}}getUsageStats(){return this.stats}validateTranslations(){return{uiCount:Object.keys(this.uiMessages).length,blocklyCount:Object.keys(this.blocklyMessages).length,totalCount:Object.keys(this.messages).length,language:this.currentLanguage,isNative:this.isNativeLanguage()}}clearCache(){this.messages={},this.uiMessages={},this.blocklyMessages={}}async reloadTranslations(){return this.clearCache(),await this.loadTranslations(this.currentLanguage)}}function stripLeadingEmoji(e){return e&&"string"==typeof e?e.replace(/^[\u{1F300}-\u{1F9FF}\u{2600}-\u{2B55}\u{FE00}-\u{FE0F}\u{200D}\u{20E3}\u{E0020}-\u{E007F}\u{2699}\u{2B07}]+\s*/gu,"").trim():e}function updateSelectElements(){["boardSelect","portSelect","agentOsSelect"].forEach(e=>{const a=document.getElementById(e);a&&(a.querySelectorAll("optgroup[data-i18n]").forEach(e=>{e.label=stripLeadingEmoji(window.i18n.getUIMessage(e.getAttribute("data-i18n")))}),a.querySelectorAll("option[data-i18n]").forEach(e=>{e.textContent=window.i18n.getUIMessage(e.getAttribute("data-i18n"))}))}),updateLanguageSelector()}function updateLanguageSelector(){const e=document.getElementById("languageSelect");if(e&&(e.innerHTML="",window.i18n.generateLanguageOptions().forEach(a=>{const t=document.createElement("option");t.value=a.value,t.textContent=a.text,e.appendChild(t)}),e.value=window.i18n.getCurrentLanguage(),!e.value)){const a=window.i18n.getCurrentLanguage(),t=e.querySelector(`option[value="${a}"]`);t&&(t.selected=!0)}}window.i18n=new I18nManager,window.initializeI18n=async function(){return await window.i18n.loadTranslations()?(window.i18n.validateTranslations(),updateLanguageSelector(),!0):(console.error("âŒ ë‹¤êµ­ì–´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨"),!1)},window.updateUITexts=function(){document.querySelectorAll("[data-i18n]:not(optgroup):not(option)").forEach(e=>{const a=e.getAttribute("data-i18n"),t=stripLeadingEmoji(window.i18n.getUIMessage(a));e.hasAttribute("title")?e.title=t:e.textContent=t}),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const a=e.getAttribute("data-i18n-placeholder");e.placeholder=window.i18n.getUIMessage(a)}),updateSelectElements()},window.i18nDebug={getStats:()=>window.i18n.getUsageStats(),getSupportedLanguages:()=>window.i18n.getAllSupportedLanguages(),getCurrentLanguage:()=>window.i18n.getCurrentLanguage(),isNative:()=>window.i18n.isNativeLanguage(),testTranslation:e=>window.i18n.getMessage(e),validate:()=>window.i18n.validateTranslations(),getUIMessages:()=>window.i18n.uiMessages,getBlocklyMessages:()=>window.i18n.blocklyMessages,getAllMessages:()=>window.i18n.messages,reload:()=>window.i18n.reloadTranslations(),clearCache:()=>window.i18n.clearCache(),detectConflicts:()=>window.i18n.detectKeyConflicts()};