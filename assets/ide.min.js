window.IDEUtils={formatBytes(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB"][t]},logToConsole(e,t=!1){const o=document.getElementById("consoleOutput");if(o){if(e.includes("ì§„í–‰:")||e.includes("Progress")||e.toLowerCase().includes("progress")||e.includes("%")&&(e.includes("ì»´íŒŒì¼")||e.includes("ì—…ë¡œë“œ")||e.includes("Compiling")||e.includes("Uploading"))){const t=o.textContent.split("\n"),n=t[t.length-1]||"";n.includes("ì§„í–‰:")||n.includes("Progress")||n.toLowerCase().includes("progress")?(t[t.length-1]=e,o.textContent=t.join("\n")):o.textContent+=(o.textContent?"\n":"")+e}else o.textContent+=e+"\n";o.scrollTop=o.scrollHeight}},downloadFile(e,t){const o=document.createElement("a");o.href=URL.createObjectURL(e),o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)},loadScript:e=>new Promise((t,o)=>{const n=window.define;window.define=void 0,document.querySelectorAll('script[src*="/msg/"]').forEach(e=>e.remove());const i=document.createElement("script");i.src=e,i.async=!1,i.onload=()=>{window.define=n,console.log(`ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ: ${e}`),setTimeout(t,50)},i.onerror=()=>{window.define=n,console.error(`ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨: ${e}`),o(new Error(`Script load error for ${e}`))},document.head.appendChild(i)}),cacheElements(e){const t={};return e.forEach(e=>{t[e]=document.getElementById(e)}),t},async copyCodeToClipboard(e){try{return await navigator.clipboard.writeText(e),this.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("js_log_codeCopiedSuccess","ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."):"ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."),!0}catch(e){return this.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("js_log_codeCopiedFail","í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),!1}},updateBoardIndicator(e,t){t&&(t.textContent=e.toUpperCase(),t.className="board-indicator",["uno","nano","mega"].includes(e)?t.classList.add("board-arduino"):e.startsWith("esp32")?t.classList.add("board-esp32"):e.includes("pico")&&t.classList.add("board-pico"))},debug(e,t){const o=`[DEBUG:${e}] ${JSON.stringify(t)}`;console.log(o),this.logToConsole(o)},isElementVisible:e=>e&&null!==e.offsetParent,delay:e=>new Promise(t=>setTimeout(t,e)),romanizeKorean(e){if(!e)return"";const t=["g","kk","n","d","tt","r","m","b","pp","s","ss","","j","jj","ch","k","t","p","h"],o=["a","ae","ya","yae","eo","e","yeo","ye","o","wa","wae","oe","yo","u","wo","we","wi","yu","eu","ui","i"],n=["","k","kk","ks","n","nj","nh","t","l","lg","lm","lb","ls","lt","lp","lh","m","b","bs","s","ss","ng","j","ch","k","t","p","h"];let i="";for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);if(a>=44032&&a<=55203){const e=a-44032,s=e%28,r=(e-s)/28%21;i+=t[Math.floor((e-s)/28/21)]+o[r]+n[s]}else i+=e.charAt(s)}return i.replace(/\s+/g,"")}},window.IDEI18n={currentLanguage:"ko",getBlocklyLanguageCode:e=>({zh:"zh-hans","zh-tw":"zh-hant",fil:"en",fa:"en",hi:"en",id:"en",th:"en",uz:"en"}[e]||e),async initialize(){try{"function"==typeof initializeI18n&&await initializeI18n(),this.currentLanguage=i18n?i18n.getCurrentLanguage():"ko";const e=this.getBlocklyLanguageCode(this.currentLanguage);try{const t=`https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0/msg/${e}.js`;await window.IDEUtils.loadScript(t)}catch(e){console.warn(this.getMsg("i18n_blockly_load_fail","[3] Blockly ê³µì‹ ë²ˆì—­ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©"))}window.Msg&&Blockly.setLocale(window.Msg),i18n&&i18n.messages&&this.injectMessagesIntoBlockly(i18n.messages),this.setDefaultMessages(),this.validateMessages()}catch(e){console.error(this.getMsg("i18n_init_fail","ë²ˆì—­ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:"),e),this.setDefaultMessages()}},async changeLanguage(e){if(e===this.currentLanguage)return;const t=document.getElementById("loadingOverlay"),o=document.getElementById("loadingText"),n={ko:this.getMsg("loading_system_init","ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘..."),en:this.getMsg("loading_system_init_en","Initializing system..."),ja:this.getMsg("loading_system_init_ja","ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­..."),zh:this.getMsg("loading_system_init_zh","ç³»ç»Ÿåˆå§‹åŒ–ä¸­..."),es:this.getMsg("loading_system_init_es","Inicializando sistema...")};t.classList.remove("hidden"),o.textContent=n[e]||n.en;try{if("undefined"!=typeof i18n&&"function"==typeof i18n.changeLanguage){if(!await i18n.changeLanguage(e))throw new Error(this.getMsg("language_json_load_fail","{newLanguage}.json ë¡œë“œ ì‹¤íŒ¨").replace("{newLanguage}",e));this.injectMessagesIntoBlockly(i18n.messages);const t=`https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0/msg/${this.getBlocklyLanguageCode(e)}.js`;if(await window.IDEUtils.loadScript(t),window.Msg&&Blockly.setLocale(window.Msg),"function"==typeof window.defineArduinoBlocks&&window.defineArduinoBlocks(),"function"==typeof window.defineHuskyLensBlocks&&window.defineHuskyLensBlocks(),"function"==typeof window.defineTinyMLBlocks&&window.defineTinyMLBlocks(),window.IDEEditors&&window.IDEEditors.recreateWorkspace&&await window.IDEEditors.recreateWorkspace(),this.updateUITexts(),this.currentLanguage=e,this.ensureMonacoLTRDirection(),window.IDEServerComm&&window.IDEServerComm.websocket)try{window.IDEServerComm.websocket.send(JSON.stringify({type:"language-change",payload:{language:e}}))}catch(e){console.warn("PC ì—ì´ì „íŠ¸ ì–¸ì–´ ë³€ê²½ ì•Œë¦¼ ì‹¤íŒ¨:",e)}window.IDEUtils.logToConsole(this.getMsg("language_change_success","ì–¸ì–´ê°€ {lang}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.").replace("{lang}",e))}}catch(e){console.error("ì–¸ì–´ ë³€ê²½ ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole(this.getMsg("language_change_fail","ì–¸ì–´ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: {errorMsg}").replace("{errorMsg}",e.message))}finally{t.classList.add("hidden")}},updateUITexts(){"function"==typeof window.updateUITexts&&window.updateUITexts();const e=document.getElementById("languageStatus");if(e&&i18n){const t=!i18n.isNativeLanguage||i18n.isNativeLanguage();e.textContent=t?this.getMsg("languageStatus_official","ê³µì‹ ì§€ì›"):this.getMsg("languageStatus_browser","ë¸Œë¼ìš°ì € ë²ˆì—­"),e.style.color=t?"var(--success-color)":"var(--warning-color)"}i18n&&i18n.isRTLLanguage&&i18n.isRTLLanguage()?(document.body.classList.add("rtl"),this.ensureMonacoLTRDirection()):document.body.classList.remove("rtl");const t=document.getElementById("codeTitle");if(t){const e="text"===(window.arduinoIDE?window.arduinoIDE.currentMode:"block")?this.getMsg("codeTitle_textMode","Arduino C++ ì½”ë“œ ì—ë””í„°"):this.getMsg("codeTitle","ì‹¤ì‹œê°„ Arduino C++ ì½”ë“œ");t.textContent=e.replace(/^[\u{1F300}-\u{1F9FF}\u{2600}-\u{2B55}\u{FE00}-\u{FE0F}\u{200D}\u{20E3}]+\s*/gu,"").trim()}},ensureMonacoLTRDirection(){const e=document.getElementById("monacoEditor");e&&(e.style.direction="ltr",e.style.textAlign="left",e.setAttribute("dir","ltr"),setTimeout(()=>{e.querySelectorAll(".monaco-editor, .overflow-guard, .monaco-scrollable-element, .view-lines, .view-line").forEach(e=>{e.style.direction="ltr",e.style.textAlign="left"}),e.querySelectorAll("textarea").forEach(e=>{e.style.direction="ltr",e.style.textAlign="left"}),window.IDEEditors&&window.IDEEditors.monacoEditor&&window.IDEEditors.monacoEditor.layout()},100))},injectMessagesIntoBlockly(e){for(const t in e)Blockly.Msg[t]=e[t]},getMsg:(e,t=e)=>void 0!==window.i18n&&window.i18n.getUIMessage?window.i18n.getUIMessage(e,t):t,setDefaultMessages(){const e={LOGIC_BOOLEAN_TRUE:"true",LOGIC_BOOLEAN_FALSE:"false",LOGIC_OPERATION_AND:"and",LOGIC_OPERATION_OR:"or",CONTROLS_IF_MSG_IF:"if",CONTROLS_REPEAT_TITLE:"repeat %1 times",MATH_NUMBER_TOOLTIP:"A number.",TEXT_TEXT_TOOLTIP:"A letter, word, or line of text.",VARIABLES_SET:"set %1 to %2",VARIABLES_DEFAULT_NAME:"item"};for(const[t,o]of Object.entries(e))Blockly.Msg[t]||(Blockly.Msg[t]=o)},validateMessages(){const e=["LOGIC_BOOLEAN_TRUE","LOGIC_BOOLEAN_FALSE","LOGIC_OPERATION_AND","LOGIC_OPERATION_OR","CONTROLS_IF_MSG_IF","CONTROLS_REPEAT_TITLE","MATH_NUMBER_TOOLTIP","TEXT_TEXT_TOOLTIP","VARIABLES_SET","VARIABLES_DEFAULT_NAME"].filter(e=>!Blockly.Msg[e]);e.length>0&&(console.warn("âš ï¸ ëˆ„ë½ëœ í•µì‹¬ ë©”ì‹œì§€:",e),e.forEach(e=>{Blockly.Msg[e]=this.getEmergencyFallback(e)}))},getEmergencyFallback:e=>({LOGIC_BOOLEAN_TRUE:"true",LOGIC_BOOLEAN_FALSE:"false",LOGIC_OPERATION_AND:"and",LOGIC_OPERATION_OR:"or",CONTROLS_IF_MSG_IF:"if",CONTROLS_REPEAT_TITLE:"repeat %1 times",MATH_NUMBER_TOOLTIP:"A number.",TEXT_TEXT_TOOLTIP:"Text.",VARIABLES_SET:"set %1 to %2",VARIABLES_DEFAULT_NAME:"item"}[e]||e),getCurrentLanguage(){return this.currentLanguage}},window.IDEEditors={workspace:null,monacoEditor:null,currentMode:"block",initialBlocksAdded:!1,async initializeBlockly(){try{const e={event_blocks:{colourPrimary:"#FFAB19",colourSecondary:"#FF8F00",colourTertiary:"#FF6F00",hat:"cap"},logic_blocks:{colourPrimary:"#5CB1D6"},math_blocks:{colourPrimary:"#59C059"},text_blocks:{colourPrimary:"#82a52d"},variable_blocks:{colourPrimary:"#98607F"},procedure_blocks:{colourPrimary:"#8E61A3"}};window.eventTheme=Blockly.Theme.defineTheme("eventTheme",{base:Blockly.Themes.Scratch,blockStyles:e}),window.eventThemeDark=Blockly.Theme.defineTheme("eventThemeDark",{base:Blockly.Themes.Scratch,blockStyles:e,componentStyles:{workspaceBackgroundColour:"#1E293B",toolboxBackgroundColour:"#1a1f35",toolboxForegroundColour:"#CBD5E1",flyoutBackgroundColour:"#1a1f35",flyoutForegroundColour:"#CBD5E1",flyoutOpacity:1,scrollbarColour:"#475569",scrollbarOpacity:.6}}),await this.createWorkspace()}catch(e){console.error("Blockly ì´ˆê¸°í™” ì‹¤íŒ¨:",e)}},async createWorkspace(){return new Promise(e=>{try{this.workspace&&this.workspace.dispose();const t=document.getElementById("toolbox"),o=()=>{if("function"==typeof generateToolbox)try{const o=document.getElementById("boardSelect"),n=o?o.value:"uno";t.innerHTML=generateToolbox(n),this.createWorkspaceWithToolbox(e)}catch(o){console.error("íˆ´ë°•ìŠ¤ ìƒì„± ì˜¤ë¥˜:",o),t.innerHTML="<xml></xml>",this.createWorkspaceWithToolbox(e)}else setTimeout(o,100)};o()}catch(t){console.error("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì˜¤ë¥˜:",t),e()}})},createWorkspaceWithToolbox(e){try{const t=document.getElementById("toolbox");this.workspace=Blockly.inject("blocklyDiv",{toolbox:t,renderer:"zelos",theme:document.body.classList.contains("dark-mode")&&window.eventThemeDark?window.eventThemeDark:window.eventTheme,grid:{spacing:0,length:3,colour:"#ccc",snap:!0},zoom:{controls:!0,wheel:!1,startScale:.8,maxScale:3,minScale:.3,scaleSpeed:1.2},trashcan:!0,scrollbars:!0,sounds:!0,move:{scrollbars:!0,drag:!0,wheel:!0}}),this.setupFlyoutScrollMemory(),this.setupZoomOnWheel(),this.workspace.addChangeListener(()=>this.updateCode()),"undefined"!=typeof Arduino&&Arduino.init&&Arduino.init(this.workspace),this.updateControlBlockColors(),void 0!==window.BlockAssemblyRecorder&&(window.BlockAssemblyRecorder.init(this.workspace),"function"==typeof setupBlockDoubleClick&&setupBlockDoubleClick(this.workspace)),void 0!==window.BlockImageSaver&&window.BlockImageSaver.registerContextMenu&&window.BlockImageSaver.registerContextMenu(),setTimeout(()=>{if(this.workspace&&!this.initialBlocksAdded&&0===this.workspace.getAllBlocks(!1).length){const e='\n                    <xml xmlns="https://developers.google.com/blockly/xml">\n                        <block type="arduino_uno_starts_up" x="50" y="50">\n                            <next>\n                                <block type="arduino_setup">\n                                    <next>\n                                        <block type="arduino_loop"></block>\n                                    </next>\n                                </block>\n                            </next>\n                        </block>\n                    </xml>';try{const t=Blockly.utils.xml.textToDom(e);Blockly.Xml.domToWorkspace(t,this.workspace),this.initialBlocksAdded=!0}catch(e){console.error("âš ï¸ ì´ˆê¸° ë¸”ë¡ ë°°ì¹˜ ì‹¤íŒ¨:",e)}}this.updateCode(),this.workspace&&this.workspace.updateToolbox(t),e()},100)}catch(t){console.error("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì‹¤íŒ¨:",t),e()}},async recreateWorkspace(){const e=this.workspace?Blockly.Xml.workspaceToDom(this.workspace):null;if(await this.createWorkspace(),e)try{Blockly.Xml.domToWorkspace(e,this.workspace)}catch(e){console.warn("ë¸”ë¡ ë³µì› ì¤‘ ì˜¤ë¥˜:",e)}},async initializeMonaco(){if(this.monacoEditor)return console.log("âœ… Monaco ì—ë””í„° ì´ë¯¸ ì´ˆê¸°í™”ë¨"),Promise.resolve();window.monacoLoadPromise||(window.monacoLoadPromise=this._loadMonacoWithFallback());try{return await window.monacoLoadPromise,this._createMonacoEditor()}catch(e){throw console.error("Monaco ì´ˆê¸°í™” ì‹¤íŒ¨:",e),e}},async _loadMonacoWithFallback(){if("undefined"!=typeof require&&require.config&&window.monacoLoaderReady)return Promise.resolve();const e=["https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min","https://cdn.jsdelivr.net/npm/monaco-editor@0.34.0/min","https://unpkg.com/monaco-editor@0.34.0/min"],t=e=>new Promise((t,o)=>{if(document.querySelector(`link[href="${e}"]`))return void t();const n=document.createElement("link");n.rel="stylesheet",n.href=e,n.setAttribute("data-name","vs/editor/editor.main"),n.onload=()=>t(),n.onerror=()=>o(new Error("CSS ë¡œë“œ ì‹¤íŒ¨: "+e)),document.head.appendChild(n)}),o=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0;const i=setTimeout(()=>{n.remove(),o(new Error("Timeout: "+e))},15e3);n.onload=()=>{clearTimeout(i),t()},n.onerror=()=>{clearTimeout(i),n.remove(),o(new Error("Failed: "+e))},document.head.appendChild(n)});for(let n=0;n<e.length;n++){const i=e[n];console.log(`ğŸ”„ Monaco ë¡œë“œ ì‹œë„ (CDN ${n+1}/${e.length}): ${i}`);try{if(await t(`${i}/vs/editor/editor.main.css`),await o(`${i}/vs/loader.min.js`),"undefined"!=typeof require&&require.config)return require.config({paths:{vs:`${i}/vs`}}),window.monacoLoaderReady=!0,window.monacoBaseUrl=i,void console.log(`âœ… Monaco loader ë¡œë“œ ì„±ê³µ (CDN ${n+1}): ${i}`)}catch(e){console.warn(`âš ï¸ Monaco CDN ${n+1} ì‹¤íŒ¨:`,e.message)}}const n="Monaco Editorë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.";throw console.error("âŒ "+n),new Error(n)},_createMonacoEditor(){return new Promise((e,t)=>{require(["vs/editor/editor.main"],()=>{try{const t=document.getElementById("monacoEditor");this.monacoEditor=monaco.editor.create(t,{value:window.IDEI18n?window.IDEI18n.getMsg("template_arduino"):"// Arduino ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‘ì„±í•˜ì„¸ìš”",language:"cpp",theme:"vs-dark",automaticLayout:!0,minimap:{enabled:window.innerWidth>1200},wordWrap:"on",renderControlCharacters:!1,renderWhitespace:"none"}),this.forceMonacoLTRDirection(t),console.log("âœ… Monaco ì—ë””í„° ì´ˆê¸°í™” ì™„ë£Œ (ì§€ì—° ë¡œë”© + CDN Fallback)");const o=document.getElementById("compileBtn");o&&(o.disabled=!1),e()}catch(e){console.error("Monaco ì—ë””í„° ì´ˆê¸°í™” ì‹¤íŒ¨:",e),t(e)}})})},forceMonacoLTRDirection(e){e.style.direction="ltr",e.style.textAlign="left",e.setAttribute("dir","ltr"),setTimeout(()=>{e.querySelectorAll(".monaco-editor, .overflow-guard, .monaco-scrollable-element").forEach(e=>{e.style.direction="ltr",e.style.textAlign="left"}),e.querySelectorAll("textarea").forEach(e=>{e.style.direction="ltr",e.style.textAlign="left"})},100)},async switchMode(e){this.currentMode=e;const t="block"===e,o=document.getElementById("blockModeBtn"),n=document.getElementById("textModeBtn");o&&o.classList.toggle("active",t),n&&n.classList.toggle("active",!t);const i=document.getElementById("editorArea"),s=document.getElementById("blocklyPanel"),a=document.getElementById("codePreview"),r=document.getElementById("monacoEditor");if(i&&i.classList.toggle("text-mode",!t),s&&s.classList.toggle("hidden",!t),a&&(a.style.display=t?"block":"none"),r&&r.classList.toggle("hidden",t),window.IDEI18n&&window.IDEI18n.updateUITexts(),!t){if(!this.monacoEditor){r&&(r.innerHTML='\n                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1e1e1e; color: #fff; position: absolute; top: 0; left: 0; right: 0; bottom: 0;">\n                            <div style="text-align: center;">\n                                <div style="font-size: 24px; margin-bottom: 10px;">â³</div>\n                                <div>Monaco Editor ë¡œë”© ì¤‘...</div>\n                            </div>\n                        </div>\n                    ');try{console.log("ğŸ”„ Monaco ì§€ì—° ë¡œë”© ì‹œì‘..."),await this.initializeMonaco(),console.log("âœ… Monaco ì§€ì—° ë¡œë”© ì™„ë£Œ")}catch(e){return console.error("âŒ Monaco ë¡œë”© ì‹¤íŒ¨:",e),void(r&&(r.innerHTML='\n                            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1e1e1e; color: #ff6b6b; position: absolute; top: 0; left: 0; right: 0; bottom: 0;">\n                                <div style="text-align: center;">\n                                    <div style="font-size: 24px; margin-bottom: 10px;">âŒ</div>\n                                    <div>Monaco Editor ë¡œë”© ì‹¤íŒ¨</div>\n                                    <div style="font-size: 12px; margin-top: 5px;">ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”</div>\n                                </div>\n                            </div>\n                        '))}}const e=()=>{const e=document.getElementById("monacoEditor");if(e&&this.forceMonacoLTRDirection(e),this.monacoEditor){this.monacoEditor.layout();const e=this.generateArduinoCode();e&&e.trim()&&!e.includes("ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´")&&this.monacoEditor.setValue(e)}};setTimeout(e,50),setTimeout(e,200),setTimeout(e,500)}const l=t?window.IDEI18n?window.IDEI18n.getMsg("mode_block","ë¸”ë¡ì½”ë”©"):"ë¸”ë¡ì½”ë”©":window.IDEI18n?window.IDEI18n.getMsg("mode_text","í…ìŠ¤íŠ¸ì½”ë”©"):"í…ìŠ¤íŠ¸ì½”ë”©";window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("mode_switch_message","{modeName} ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤."):"{modeName} ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.").replace("{modeName}",l))},updateCode(){if("block"===this.currentMode&&this.workspace){"undefined"!=typeof Arduino&&Arduino.init&&Arduino.init(this.workspace);const e=this.generateArduinoCode(),t=document.getElementById("codePreview");if(t){const o=window.IDEI18n?window.IDEI18n.getMsg("codePreview_initial","// ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´ ì—¬ê¸°ì— ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤."):"// ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´ ì—¬ê¸°ì— ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.";t.textContent=e||o}}},generateArduinoCode(){try{return"undefined"!=typeof Arduino&&Arduino.workspaceToCode?Arduino.workspaceToCode(this.workspace):"undefined"!=typeof Blockly?Blockly.JavaScript.workspaceToCode(this.workspace):"// ì½”ë“œ ìƒì„±ê¸°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}catch(e){return console.error("ì½”ë“œ ìƒì„± ì˜¤ë¥˜:",e),"// ì½”ë“œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}},getCurrentCode(){return"block"===this.currentMode?this.generateArduinoCode():this.monacoEditor?this.monacoEditor.getValue():""},updateControlBlockColors(){this._controlColorsPatched||(this._controlColorsPatched=!0,["controls_if","controls_repeat_ext","controls_whileUntil","controls_for","controls_flow_statements"].forEach(e=>{const t=Blockly.Blocks[e];if(!t||!t.init||t._colorPatched)return;const o=t.init;t.init=function(){o.call(this),this.setColour("#FF9800")},t._colorPatched=!0}))},updateEditorTemplate(e){const t={arduino:window.IDEI18n?window.IDEI18n.getMsg("template_arduino","// Arduino ì½”ë“œ"):"// Arduino ì½”ë“œ",esp32:window.IDEI18n?window.IDEI18n.getMsg("template_esp32","// ESP32 ì½”ë“œ"):"// ESP32 ì½”ë“œ",pico:window.IDEI18n?window.IDEI18n.getMsg("template_pico","// Raspberry Pi Pico ì½”ë“œ"):"// Raspberry Pi Pico ì½”ë“œ"};let o=t.arduino;if(e&&e.startsWith("esp32")?o=t.esp32:e&&e.includes("pico")&&(o=t.pico),"text"===this.currentMode&&this.monacoEditor){const e=this.monacoEditor.getValue().trim();e&&!Object.values(t).some(t=>t.trim()===e)||this.monacoEditor.setValue(o)}},getWorkspaceXml(){if(!this.workspace)return null;const e=Blockly.Xml.workspaceToDom(this.workspace);return Blockly.Xml.domToText(e)},loadWorkspaceFromXml(e){if(this.workspace&&e)try{let t,o=[];if(window.IDEBlocklyUtils&&window.IDEBlocklyUtils.preprocessXmlForUnknownBlocks){const n=window.IDEBlocklyUtils.preprocessXmlForUnknownBlocks(e);t=n.xmlDom,o=n.unknownBlocks}else t=Blockly.utils.xml.textToDom(e);this.workspace.clear(),Blockly.Xml.domToWorkspace(t,this.workspace),o.length>0&&(console.warn("[Unknown Blocks ê°ì§€]",o),window.IDEUtils.logToConsole(`âš ï¸ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸”ë¡ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤: ${o.join(", ")}`))}catch(e){console.error("XML ë¡œë“œ ì‹¤íŒ¨:",e)}},setupFlyoutScrollMemory(){if(!this.workspace)return;const e=this.workspace.getToolbox(),t=this.workspace.getFlyout();if(!e||!t)return;const o={};let n=null;const i=t.getWorkspace();if(!i)return;let s=null;i.addChangeListener(e=>{e.type===Blockly.Events.VIEWPORT_CHANGE&&n&&(s&&clearTimeout(s),s=setTimeout(()=>{n&&void 0!==i.scrollY&&(o[n]=i.scrollY)},50))}),e.updateFlyout_.bind(e),e.updateFlyout_=function(e,s){if(n&&void 0!==i.scrollY&&(o[n]=i.scrollY),!(s&&(e!==s||s.isCollapsible&&s.isCollapsible())&&s.getContents&&s.getContents().length))return t.hide(),void(n=null);const a=s.getId?s.getId():null;t.show(s.getContents()),a&&void 0!==o[a]?requestAnimationFrame(()=>{try{const e=o[a],t=i.scrollbar;t&&t.vScroll&&t.vScroll.set&&t.vScroll.set(Math.abs(e),!1),i.scrollY=e,i.translate(i.scrollX,e)}catch(e){t.scrollToStart()}}):t.scrollToStart(),n=a}},setupZoomOnWheel(){const e=document.getElementById("blocklyDiv");e&&this.workspace&&e.addEventListener("wheel",t=>{if(t.ctrlKey||t.metaKey){t.preventDefault(),t.stopPropagation(),this.workspace.getMetrics();const o=t.clientX-e.getBoundingClientRect().left,n=t.clientY-e.getBoundingClientRect().top,i=this.workspace.scale,s=1.2;let a=(t.deltaY>0?-1:1)>0?i*s:i/s;a=Math.max(.3,Math.min(3,a)),this.workspace.setScale(a);const r=a-i,l=o/i*r,d=n/i*r;this.workspace.scroll(l,d),console.log(`ì¤Œ ë ˆë²¨: ${(100*a).toFixed(0)}%`)}},{passive:!1,capture:!0})},updateToolbox(e){try{if(!this.workspace)return void console.warn("[IDE] ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");console.log(`[IDE] íˆ´ë°•ìŠ¤ ì—…ë°ì´íŠ¸ - ë³´ë“œ: ${e}`);const t=document.getElementById("toolbox");t&&"function"==typeof generateToolbox&&(t.innerHTML=generateToolbox(e),this.workspace.updateToolbox(t),console.log(`âœ… íˆ´ë°•ìŠ¤ ì—…ë°ì´íŠ¸ ì™„ë£Œ - ë³´ë“œ: ${e}`))}catch(e){console.error("íˆ´ë°•ìŠ¤ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",e)}}};const PARTS_REGISTRY={ssd1306_setup_i2c:{partId:"dis-011",label:"OLED 0.96 SSD1306",pinFields:[{name:"ADDR",source:"field"}],pinType:"i2c"},sh110x_setup_i2c:{partId:"dis-012",label:"OLED 1.3 SH110X",pinFields:[{name:"ADDR",source:"field"}],pinType:"i2c"},sh1106_setup:{partId:"dis-012",label:"OLED 1.3 SH1106",pinFields:[],pinType:"i2c"},oled_han_setup:{partId:"dis-011",label:"OLED í•œê¸€",pinFields:[],pinType:"i2c"},lcd_i2c_setup:{partId:"dis-001",label:"I2C 1602 LCD",pinFields:[{name:"ADDRESS",source:"field"}],pinType:"i2c"},tm1637_setup:{partId:"dis-010",label:"7ì„¸ê·¸ë¨¼íŠ¸ TM1637",pinFields:[{name:"CLK_PIN",source:"value"},{name:"DATA_PIN",source:"value"}],pinType:"digital"},neopixel_setup:{partId:"dis-013",label:"ë„¤ì˜¤í”½ì…€",pinFields:[{name:"PIN",source:"value"}],pinType:"digital"},ht16k33_setup:{partId:"dis-016",label:"ë„íŠ¸ë§¤íŠ¸ë¦­ìŠ¤ I2C",pinFields:[{name:"ADDR",source:"field"}],pinType:"i2c"},servo_setup:{partId:"m-006",label:"MG90S ì„œë³´",pinFields:[{name:"PIN",source:"value"}],pinType:"digital"},geekservo_setup:{partId:"m-007",label:"ê¸±ì„œë³´ 360",pinFields:[{name:"PIN",source:"value"}],pinType:"digital"},dcmotor_setup:{partId:"m-002",label:"DCëª¨í„° L9110",pinFields:[{name:"PIN_A",source:"value"},{name:"PIN_B",source:"value"}],pinType:"pwm"},pca9685_dcmotor_setup:{partId:"m-018",label:"ë“€ì–¼ ëª¨í„° ë“œë¼ì´ë²„ PCA9685",pinFields:[{name:"ADDR",source:"field"}],pinType:"i2c"},accelstepper_setup:{partId:"m-013",label:"ìŠ¤í…ëª¨í„° ë“œë¼ì´ë²„",pinFields:[{name:"PIN1",source:"value"},{name:"PIN2",source:"value"}],pinType:"digital"},steppermulti_setup:{partId:"m-013",label:"ìŠ¤í…ëª¨í„°",pinFields:[{name:"PIN1",source:"value"},{name:"PIN2",source:"value"},{name:"PIN3",source:"value"},{name:"PIN4",source:"value"}],pinType:"digital"},pwmservo_setup:{partId:"m-020",label:"16ì±„ë„ ì„œë³´ ë“œë¼ì´ë²„",pinFields:[{name:"ADDR",source:"field"}],pinType:"i2c"},ultrasonic_setup:{partId:"d-007",label:"ì´ˆìŒíŒŒ ì„¼ì„œ",pinFields:[{name:"TRIG_PIN",source:"field"},{name:"ECHO_PIN",source:"field"}],pinType:"digital"},dht_setup:{partId:"d-001",label:"ì˜¨ìŠµë„ ì„¼ì„œ DHT",pinFields:[{name:"PIN",source:"value"}],pinType:"digital"},dallas_temp_setup:{partId:"a-005",label:"ì˜¨ë„ ì„¼ì„œ Dallas",pinFields:[{name:"PIN",source:"field"}],pinType:"digital"},pms_setup:{partId:"d-004",label:"ë¯¸ì„¸ë¨¼ì§€ ì„¼ì„œ PMS",pinFields:[{name:"RX_PIN",source:"value"},{name:"TX_PIN",source:"value"}],pinType:"serial"},mhz19_setup:{partId:"d-003",label:"CO2 ì„¼ì„œ MHZ19",pinFields:[{name:"RX_PIN",source:"value"},{name:"TX_PIN",source:"value"}],pinType:"serial"},fingerprint_setup:{partId:"d-029",label:"ì§€ë¬¸ ì„¼ì„œ",pinFields:[{name:"RX_PIN",source:"value"},{name:"TX_PIN",source:"value"}],pinType:"serial"},rotary_setup:{partId:"d-028",label:"ë¡œí„°ë¦¬ ì—”ì½”ë”",pinFields:[{name:"DT_PIN",source:"value"},{name:"CLK_PIN",source:"value"}],pinType:"digital"},thermistor_setup:{partId:"a-005",label:"ì„œë¯¸ìŠ¤í„° NTC",pinFields:[{name:"ANALOG_PIN",source:"value"}],pinType:"analog"},gravity_tds_setup:{partId:"a-011",label:"TDS ìˆ˜ì§ˆ ì„¼ì„œ",pinFields:[{name:"PIN",source:"value"}],pinType:"analog"},dfrobot_ph_setup:{partId:"a-009",label:"pH ì„¼ì„œ",pinFields:[{name:"PIN",source:"value"}],pinType:"analog"},turbidity_setup:{partId:"a-013",label:"íƒë„ ì„¼ì„œ",pinFields:[{name:"PIN",source:"value"}],pinType:"analog"},uv_sensor_setup:{partId:"a-007",label:"UV ì„¼ì„œ",pinFields:[{name:"PIN",source:"value"}],pinType:"analog"},hx711_setup:{partId:"i2c-010",label:"ë¬´ê²Œ ì„¼ì„œ HX711",pinFields:[{name:"DOUT_PIN",source:"value"},{name:"CLK_PIN",source:"value"}],pinType:"digital"},i2c_weight_setup:{partId:"i2c-010",label:"I2C ë¬´ê²Œ ì„¼ì„œ",pinFields:[{name:"ADDRESS",source:"value"}],pinType:"i2c"},ds1307_setup:{partId:"i2c-001",label:"RTC DS1307",pinFields:[],pinType:"i2c"},bmp280_setup:{partId:"i2c-006",label:"ê¸°ì•• ê³ ë„ BMP280",pinFields:[],pinType:"i2c"},bx_mpu_setup:{partId:"i2c-007",label:"6ì¶• ìì´ë¡œ MPU6050",pinFields:[],pinType:"i2c"},sgp30_setup:{partId:"i2c-004",label:"CO2/TVOC SGP30",pinFields:[],pinType:"i2c"},vl53l0x_setup:{partId:"i2c-009",label:"ë ˆì´ì € ê±°ë¦¬ VL53L0X",pinFields:[{name:"ADDR",source:"value"}],pinType:"i2c"},sht31_setup:{partId:"i2c-002",label:"ì˜¨ìŠµë„ SHT31",pinFields:[{name:"ADDRESS",source:"value"}],pinType:"i2c"},color_sensor_setup:{partId:"i2c-012",label:"ì»¬ëŸ¬ ì„¼ì„œ TCS34725",pinFields:[],pinType:"i2c"},mlx90614_setup:{partId:"i2c-003",label:"ë¹„ì ‘ì´‰ ì˜¨ë„ MLX90614",pinFields:[{name:"ADDRESS",source:"value"}],pinType:"i2c"},apds9960_setup:{partId:"i2c-008",label:"ì œìŠ¤ì²˜ ì„¼ì„œ APDS9960",pinFields:[],pinType:"i2c"},max30105_setup_basic:{partId:"i2c-013",label:"ì‹¬ë°• ì„¼ì„œ MAX30102",pinFields:[],pinType:"i2c"},max30105_setup_advanced:{partId:"i2c-013",label:"ì‹¬ë°• ì„¼ì„œ MAX30102",pinFields:[],pinType:"i2c"},si7021_setup:{partId:"i2c-002",label:"ì˜¨ìŠµë„ SI7021",pinFields:[],pinType:"i2c"},buzzer_tone_setup:{partId:"o-001",label:"ë¶€ì €",pinFields:[],pinType:"digital"},mp3_setup_kt403a:{partId:"o-002",label:"MP3 í”Œë ˆì´ì–´",pinFields:[{name:"RX",source:"value"},{name:"TX",source:"value"}],pinType:"serial"},sd_setup:{partId:"o-008",label:"TF ì¹´ë“œ ì–´ëŒ‘í„°",pinFields:[{name:"CS",source:"value"}],pinType:"spi"},ir_setup:{partId:"c-006",label:"IR ìˆ˜ì‹ ê¸°",pinFields:[{name:"PIN",source:"value"}],pinType:"digital"},rf433_setup:{partId:"c-003",label:"RF433 ì†¡ì‹ ",pinFields:[],pinType:"digital"},rf433_rx_setup:{partId:"c-004",label:"RF433 ìˆ˜ì‹ ",pinFields:[{name:"RX_PIN",source:"value"}],pinType:"digital"},gps_setup_tinygps:{partId:"d-031",label:"GPS ëª¨ë“ˆ",pinFields:[{name:"RX",source:"value"},{name:"TX",source:"value"}],pinType:"serial"},arduino_bt_setup:{partId:"c-001",label:"ë¸”ë£¨íˆ¬ìŠ¤ JDY-33",pinFields:[{name:"RX",source:"value"},{name:"TX",source:"value"}],pinType:"serial"},esp32_bt_setup:{partId:"c-001",label:"ESP32 ë¸”ë£¨íˆ¬ìŠ¤",pinFields:[],pinType:"none"},sys_webble_setup:{partId:"c-001",label:"Web BLE",pinFields:[],pinType:"none"},wifi_setup:{partId:"c-002",label:"WiFi",pinFields:[],pinType:"none"},wifi_ws_server_setup:{partId:"c-002",label:"WebSocket ì„œë²„",pinFields:[],pinType:"none"},esp32cam_setup:{partId:"c-010",label:"ESP32-CAM",pinFields:[],pinType:"none"},esp32s3cam_setup:{partId:"c-010",label:"ESP32-S3 CAM",pinFields:[],pinType:"none"},huskylens_setup_i2c:{partId:"i2c-014",label:"í—ˆìŠ¤í‚¤ë Œì¦ˆ I2C",pinFields:[],pinType:"i2c"},huskylens_setup_serial:{partId:"c-011",label:"í—ˆìŠ¤í‚¤ë Œì¦ˆ ì‹œë¦¬ì–¼",pinFields:[{name:"RX",source:"value"},{name:"TX",source:"value"}],pinType:"serial"},tinyml_model_setup:{partId:"ai-001",label:"TinyML ëª¨ë¸",pinFields:[],pinType:"none"},util_cal_setup:{partId:"u-001",label:"êµì • ì„¤ì •",pinFields:[],pinType:"none"}},COMMENT_KEYWORDS={analog:[{keywords:["ê³ ì˜¨ ì„¼ì„œ","high temp"],partId:"a-001",label:"ê³ ì˜¨ ì„¼ì„œ"},{keywords:["ìˆ˜ì˜¨","water temp"],partId:"a-003",label:"ìˆ˜ì˜¨ ì„¼ì„œ"},{keywords:["ntc","ì˜¨ë„ ì„¼ì„œ","temp sensor"],partId:"a-005",label:"NTC ì˜¨ë„ ì„¼ì„œ"},{keywords:["ì¡°ë„","ë¹›ì„¼ì„œ","light","cds"],partId:"a-006",label:"ë¹›ì„¼ì„œ CDS"},{keywords:["ìì™¸ì„ ","uv"],partId:"a-007",label:"UV ì„¼ì„œ"},{keywords:["í† ì–‘","ìˆ˜ë¶„","moisture","soil"],partId:"a-008",label:"í† ì–‘ìˆ˜ë¶„ ì„¼ì„œ"},{keywords:["phì„¼ì„œ","ph"],partId:"a-009",label:"pH ì„¼ì„œ"},{keywords:["ì „ê¸° ì „ë„","ì „ë„ë„","conductivity"],partId:"a-011",label:"ì „ê¸°ì „ë„ë„"},{keywords:["íƒë„","turbidity"],partId:"a-013",label:"íƒë„ ì„¼ì„œ"},{keywords:["ë¬¼ ì„¼ì„œ","water sensor"],partId:"a-015",label:"ë¬¼ ì„¼ì„œ"},{keywords:["ë¯¸ì„¸ë¨¼ì§€","fine dust","dust"],partId:"a-016",label:"ë¯¸ì„¸ë¨¼ì§€"},{keywords:["ì§„ë™ ì„¼ì„œ","vibration"],partId:"a-019",label:"ì§„ë™ ì„¼ì„œ"},{keywords:["ìì„","magnet"],partId:"a-021",label:"ìì„ ì„¼ì„œ"},{keywords:["ì•„ë‚ ë¡œê·¸ í„°ì¹˜","í„°ì¹˜ ì„¼ì„œ"],partId:"a-022",label:"ì•„ë‚ ë¡œê·¸ í„°ì¹˜"},{keywords:["fsr","ì••ë ¥","pressure","force"],partId:"a-023",label:"ì••ë ¥ ì„¼ì„œ FSR"},{keywords:["ë¬´í•œ íšŒì „","infinite rotation"],partId:"a-026",label:"ë¬´í•œ íšŒì „ ì„¼ì„œ"},{keywords:["ê°€ë³€ì €í•­","ë³¼ë¥¨","íšŒì „ ì„¼ì„œ","rotation"],partId:"a-025",label:"íšŒì „ ì„¼ì„œ"},{keywords:["ìŠ¬ë¼ì´ë”","slider"],partId:"a-027",label:"ìŠ¬ë¼ì´ë”"},{keywords:["ì¡°ì´ìŠ¤í‹±","joystick"],partId:"a-028",label:"ì¡°ì´ìŠ¤í‹±"},{keywords:["ë¼ì¸","line finder"],partId:"a-029",label:"ë¼ì¸ íŒŒì¸ë”"},{keywords:["ì‚¬ìš´ë“œ","ì†Œë¦¬","sound"],partId:"a-030",label:"ì‚¬ìš´ë“œ ì„¼ì„œ"},{keywords:["ì ì™¸ì„  ë¬¼ì²´","ir object"],partId:"a-031",label:"ì ì™¸ì„  ë¬¼ì²´ ê°ì§€"},{keywords:["ì „ë¥˜","current"],partId:"a-032",label:"ì „ë¥˜ ì„¼ì„œ"},{keywords:["ì „ì••","voltage"],partId:"a-034",label:"ì „ì•• ì„¼ì„œ"},{keywords:["mq2","lpg","ì—°ê¸°"],partId:"a-050",label:"ê°€ìŠ¤ MQ2"},{keywords:["mq3","ì•Œì½”ì˜¬"],partId:"a-051",label:"ê°€ìŠ¤ MQ3"},{keywords:["mq4","ë©”íƒ„"],partId:"a-052",label:"ê°€ìŠ¤ MQ4"},{keywords:["mq5"],partId:"a-053",label:"ê°€ìŠ¤ MQ5"},{keywords:["mq6","ë¶€íƒ„"],partId:"a-054",label:"ê°€ìŠ¤ MQ6"},{keywords:["mq7","ì¼ì‚°í™”íƒ„ì†Œ"],partId:"a-055",label:"ê°€ìŠ¤ MQ7"},{keywords:["mq8","ìˆ˜ì†Œ"],partId:"a-056",label:"ê°€ìŠ¤ MQ8"},{keywords:["mq9"],partId:"a-057",label:"ê°€ìŠ¤ MQ9"},{keywords:["mq135","ê³µê¸°ì§ˆ"],partId:"a-058",label:"ê°€ìŠ¤ MQ135"}],digital:[{keywords:["dht11","ì˜¨ìŠµë„"],partId:"d-001",label:"ì˜¨ìŠµë„ DHT11"},{keywords:["dht22"],partId:"d-002",label:"ì˜¨ìŠµë„ DHT22"},{keywords:["ì´ˆìŒíŒŒ","ultrasonic"],partId:"d-007",label:"ì´ˆìŒíŒŒ ì„¼ì„œ"},{keywords:["ìˆ˜ìœ„","water level"],partId:"d-010",label:"ìˆ˜ìœ„ ì„¼ì„œ"},{keywords:["ê´‘ì €í•­","photoresistor"],partId:"d-012",label:"ê´‘ì €í•­"},{keywords:["ì¸ì²´","pir","ëª¨ì…˜","human"],partId:"d-013",label:"ì¸ì²´ê°ì§€ PIR"},{keywords:["ê¸°ìš¸ê¸°","tilt"],partId:"d-015",label:"ê¸°ìš¸ê¸° ì„¼ì„œ"},{keywords:["ì§„ë™","vibration"],partId:"d-016",label:"ì§„ë™ ì„¼ì„œ"},{keywords:["ì´ˆë¡ ë²„íŠ¼","green button"],partId:"d-018",label:"ì´ˆë¡ ë²„íŠ¼"},{keywords:["ë¹¨ê°„ ë²„íŠ¼","red button"],partId:"d-019",label:"ë¹¨ê°„ ë²„íŠ¼"},{keywords:["ë…¸ë€ ë²„íŠ¼","yellow button"],partId:"d-020",label:"ë…¸ë€ ë²„íŠ¼"},{keywords:["ì ê¸ˆ","locker"],partId:"d-021",label:"ì ê¸ˆ ìŠ¤ìœ„ì¹˜"},{keywords:["í„°ì¹˜","touch"],partId:"d-022",label:"í„°ì¹˜ ì„¼ì„œ"},{keywords:["ë¶ˆê½ƒ","fire","flame"],partId:"d-027",label:"ë¶ˆê½ƒ ì„¼ì„œ"},{keywords:["íŒŒë€ ë²„íŠ¼","blue button","ë²„íŠ¼","button"],partId:"d-017",label:"íŒŒë€ ë²„íŠ¼"}],digital_write:[{keywords:["rgb"],partId:"dis-002",label:"RGB LED"},{keywords:["ì‹ í˜¸ë“±"],partId:"dis-003",label:"ì‹ í˜¸ë“± LED"},{keywords:["ë…¸ë€ led","yellow led"],partId:"dis-005",label:"ë…¸ë€ LED"},{keywords:["íŒŒë€ led","blue led"],partId:"dis-006",label:"íŒŒë€ LED"},{keywords:["ì´ˆë¡ led","green led"],partId:"dis-007",label:"ì´ˆë¡ LED"},{keywords:["ë ˆì´ì € 90","laser 90"],partId:"dis-008",label:"ë ˆì´ì € 90ë„"},{keywords:["ë ˆì´ì € 180","laser 180"],partId:"dis-009",label:"ë ˆì´ì € 180ë„"},{keywords:["ë ˆì´ì €","laser"],partId:"dis-008",label:"ë ˆì´ì €"},{keywords:["ì „ìì„","electromagnet"],partId:"o-004",label:"ì „ìì„"},{keywords:["ë¦´ë ˆì´","relay"],partId:"o-005",label:"ë¦´ë ˆì´"},{keywords:["íŒí”„","pump"],partId:"o-006",label:"íŒí”„ ë¦´ë ˆì´"},{keywords:["íŒ¬ ëª¨í„°","fan motor","fan"],partId:"m-002",label:"íŒ¬ ëª¨í„°"},{keywords:["ë¹¨ê°„ led","red led","led"],partId:"dis-004",label:"ë¹¨ê°„ LED"}],servo:[{keywords:["ê¸±ì„œë³´ 5kg","5kg"],partId:"m-008",label:"ê¸±ì„œë³´ 5Kg"},{keywords:["ë ˆê³  ì„œë³´","gray lego servo"],partId:"m-009",label:"íšŒìƒ‰ ë ˆê³  ì„œë³´"},{keywords:["ê¸± ì„œë³´","ê¸±ì„œë³´","geek servo","360"],partId:"m-007",label:"ê¸±ì„œë³´ 360"},{keywords:["mg90s","ì„œë³´"],partId:"m-006",label:"MG90S ì„œë³´"}],dc_motor:[{keywords:["ê¸°ì–´ ëª¨í„°","gear motor"],partId:"m-004",label:"ê¸°ì–´ ëª¨í„°"},{keywords:["ë¹¨ê°„ ì‚¬ê°","red square"],partId:"m-010",label:"ë¹¨ê°„ ì‚¬ê° ë ˆê³  DC"},{keywords:["ë¹¨ê°„ ë ˆê³ ","ë¹¨ê°„ dc","red lego"],partId:"m-011",label:"ë¹¨ê°„ ë ˆê³  DCëª¨í„°"},{keywords:["tt ëª¨í„° ì˜¤ë¥¸","tt motor right"],partId:"m-016",label:"TT ëª¨í„° ì˜¤ë¥¸ìª½"},{keywords:["tt ëª¨í„° ì™¼","tt motor left"],partId:"m-017",label:"TT ëª¨í„° ì™¼ìª½"},{keywords:["íŒŒë€ ë ˆê³ ","ë¸”ë£¨ dc","blue lego","ë¸”ë£¨ ë ˆê³ "],partId:"m-012",label:"íŒŒë€ ë ˆê³  DCëª¨í„°"}]},SETUP_CHILD_RULES={pca9685_dcmotor_setup:{keywordCategory:"dc_motor",countPattern:/(\d+)\s*ê°œ/},pwmservo_setup:{keywordCategory:"servo",countPattern:/(\d+)\s*ê°œ/},dcmotor_setup:{keywordCategory:"dc_motor",countPattern:/(\d+)\s*ê°œ/},servo_setup:{keywordCategory:"servo",countPattern:null},geekservo_setup:{keywordCategory:"servo",countPattern:null}},PIN_BLOCK_DEFAULTS={read_analog_pin:{partId:"a-025",label:"íšŒì „ ì„¼ì„œ (ê°€ë³€ì €í•­)",pinType:"analog",keywordCategory:"analog",pinField:"PIN"},read_digital_pin:{partId:"d-017",label:"íŒŒë€ ë²„íŠ¼",pinType:"digital",keywordCategory:"digital",pinField:"PIN"},write_digital_pin:{partId:"dis-004",label:"ë¹¨ê°„ LED",pinType:"digital",keywordCategory:"digital_write",pinField:"PIN"},set_pwm_pin:{partId:"dis-004",label:"ë¹¨ê°„ LED",pinType:"pwm",keywordCategory:"digital_write",pinField:"PIN"}};window.IDEFileManager={escapeXml:e=>e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",_getInputValueFromBlock(e,t){const o=e.getInput(t);if(!o||!o.connection)return null;const n=o.connection.targetBlock();if(!n)return null;if("math_number"===n.type)return n.getFieldValue("NUM");if("text"===n.type)return n.getFieldValue("TEXT");const i=n.getFieldValue("NUM");if(null!==i)return i;const s=n.getFieldValue("VALUE");return null!==s?s:"(var)"},_extractPinString(e,t){if(!t.pinFields||0===t.pinFields.length)return"i2c"===t.pinType?"I2C":"spi"===t.pinType?"SPI":(t.pinType,"-");const o=[];if(t.pinFields.forEach(n=>{let i=null;if("field"===n.source?i=e.getFieldValue(n.name):"value"===n.source&&(i=this._getInputValueFromBlock(e,n.name)),null!=i&&""!==i)if(t.pinFields.length>1){const e=n.name.replace("_PIN","").replace("PIN_","").replace("_pin","").replace("pin_","");o.push(e+":"+i)}else o.push(String(i))}),0===o.length)return"i2c"===t.pinType?"I2C":"spi"===t.pinType?"SPI":"-";if("i2c"===t.pinType&&1===o.length){const e=o[0].includes(":")?o[0].split(":").pop():o[0];if(e.startsWith("0x"))return"I2C("+e+")"}return o.join(",")},_detectPartFromComment(e,t){const o=e.getCommentText?e.getCommentText():"";if(!o)return null;const n=COMMENT_KEYWORDS[t];if(!n)return null;const i=o.toLowerCase();for(const e of n)for(const t of e.keywords)if(i.includes(t.toLowerCase()))return{partId:e.partId,label:e.label};return null},extractCircuitParts(){if(!window.IDEEditors||!window.IDEEditors.workspace)return[];const e=window.IDEEditors.workspace.getAllBlocks(!1),t=[],o=new Set;return e.forEach(e=>{const n=PARTS_REGISTRY[e.type];if(!n)return;o.add(e.id);const i=this._extractPinString(e,n);t.push({blockType:e.type,partId:n.partId,pin:i,pinType:n.pinType,label:n.label});const s=SETUP_CHILD_RULES[e.type];if(s){const o=this._detectPartFromComment(e,s.keywordCategory);if(o){let i=1;if(s.countPattern){const t=(e.getCommentText?e.getCommentText():"").match(s.countPattern);t&&(i=parseInt(t[1],10)||1)}for(let s=0;s<i;s++)t.push({blockType:e.type+"_child",partId:o.partId,pin:"MOTOR",pinType:n.pinType,label:o.label})}}}),e.forEach(e=>{if(o.has(e.id))return;const n=PIN_BLOCK_DEFAULTS[e.type];if(!n)return;o.add(e.id);const i=this._detectPartFromComment(e,n.keywordCategory),s=i?i.partId:n.partId,a=i?i.label:n.label;let r="-";if(n.pinField){const t=this._getInputValueFromBlock(e,n.pinField);null!==t&&(r=String(t))}t.push({blockType:e.type,partId:s,pin:r,pinType:n.pinType,label:a})}),t.some(e=>e.blockType&&e.blockType.endsWith("_child"))||e.forEach(e=>{if(o.has(e.id))return;if("pca9685_dcmotor_wheel_a"!==e.type&&"pca9685_dcmotor_wheel_b"!==e.type)return;o.add(e.id);const n=this._detectPartFromComment(e,"dc_motor");n&&t.push({blockType:e.type,partId:n.partId,pin:"MOTOR",pinType:"i2c",label:n.label})}),t},collectProjectMetadata(){const e=document.getElementById("fileNameInput"),t=document.getElementById("boardSelect"),o=document.getElementById("portSelect"),n={fileName:e?e.value.trim():"untitled",board:t?t.value:"uno",language:window.IDEI18n?window.IDEI18n.getCurrentLanguage():"ko",ideVersion:"2.6.0",editorMode:window.IDEEditors?window.IDEEditors.currentMode:"block",savedAt:(new Date).toISOString(),uploadPort:o&&o.value||""};return window.IDEServerComm?(n.compileStatus={success:null!==window.IDEServerComm.sketchId,board:window.IDEServerComm.compiledBoard||null,timestamp:window.IDEServerComm.lastCompileTimestamp||null},n.uploadStatus={success:window.IDEServerComm.lastUploadSuccess||!1,port:window.IDEServerComm.lastUploadPort||null,timestamp:window.IDEServerComm.lastUploadTimestamp||null}):(n.compileStatus={success:!1,board:null,timestamp:null},n.uploadStatus={success:!1,port:null,timestamp:null}),n.circuitParts=this.extractCircuitParts(),n},metadataToXml(e){let t='  <projectMetadata version="1.0">\n';return t+=`    <fileName>${this.escapeXml(e.fileName)}</fileName>\n`,t+=`    <board>${this.escapeXml(e.board)}</board>\n`,t+=`    <language>${this.escapeXml(e.language)}</language>\n`,t+=`    <ideVersion>${this.escapeXml(e.ideVersion)}</ideVersion>\n`,t+=`    <editorMode>${this.escapeXml(e.editorMode)}</editorMode>\n`,t+=`    <savedAt>${e.savedAt}</savedAt>\n`,e.uploadPort&&(t+=`    <uploadPort>${this.escapeXml(e.uploadPort)}</uploadPort>\n`),t+=`    <compileStatus success="${e.compileStatus.success}"`,e.compileStatus.board&&(t+=` board="${this.escapeXml(e.compileStatus.board)}"`),e.compileStatus.timestamp&&(t+=` timestamp="${e.compileStatus.timestamp}"`),t+=" />\n",t+=`    <uploadStatus success="${e.uploadStatus.success}"`,e.uploadStatus.port&&(t+=` port="${this.escapeXml(e.uploadStatus.port)}"`),e.uploadStatus.timestamp&&(t+=` timestamp="${e.uploadStatus.timestamp}"`),t+=" />\n",e.circuitParts&&e.circuitParts.length>0&&(t+="    <circuitParts>\n",e.circuitParts.forEach(e=>{t+="      <part",t+=` blockType="${this.escapeXml(e.blockType)}"`,t+=` partId="${this.escapeXml(e.partId)}"`,t+=` pin="${this.escapeXml(String(e.pin))}"`,t+=` pinType="${this.escapeXml(e.pinType)}"`,t+=` label="${this.escapeXml(e.label)}"`,t+=" />\n"}),t+="    </circuitParts>\n"),t+="  </projectMetadata>\n",t},extractProjectMetadata(e){try{const t=e.getElementsByTagName("projectMetadata");if(0===t.length)return null;const o=t[0],n=e=>{const t=o.getElementsByTagName(e);return 0===t.length?null:(t[0].textContent||t[0].innerText||"").trim()||null},i={fileName:n("fileName"),board:n("board"),language:n("language"),ideVersion:n("ideVersion"),editorMode:n("editorMode"),savedAt:n("savedAt"),uploadPort:n("uploadPort")},s=o.getElementsByTagName("compileStatus")[0];s&&(i.compileStatus={success:"true"===s.getAttribute("success"),board:s.getAttribute("board")||null,timestamp:s.getAttribute("timestamp")||null});const a=o.getElementsByTagName("uploadStatus")[0];a&&(i.uploadStatus={success:"true"===a.getAttribute("success"),port:a.getAttribute("port")||null,timestamp:a.getAttribute("timestamp")||null});const r=o.getElementsByTagName("circuitParts")[0];if(r){i.circuitParts=[];const e=r.getElementsByTagName("part");for(let t=0;t<e.length;t++){const o=e[t];i.circuitParts.push({blockType:o.getAttribute("blockType")||"",partId:o.getAttribute("partId")||"",pin:o.getAttribute("pin")||"",pinType:o.getAttribute("pinType")||"",label:o.getAttribute("label")||""})}}return i}catch(e){return console.warn("í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:",e),null}},restoreProjectSettings(e){if(!e)return;if(e.board){const t=document.getElementById("boardSelect");if(t&&Array.from(t.options).find(t=>t.value===e.board)&&(t.value=e.board,window.IDEUtils&&window.IDEUtils.updateBoardIndicator)){const t=document.getElementById("boardIndicator");window.IDEUtils.updateBoardIndicator(e.board,t)}}const t=[];if(e.board&&t.push(`ë³´ë“œ: ${e.board}`),e.language&&t.push(`ì–¸ì–´: ${e.language}`),e.ideVersion&&t.push(`IDE: v${e.ideVersion}`),e.savedAt&&t.push(`ì €ì¥: ${new Date(e.savedAt).toLocaleString()}`),e.compileStatus&&e.compileStatus.success&&t.push("ì»´íŒŒì¼: ì„±ê³µ"),e.uploadStatus&&e.uploadStatus.success){const o=e.uploadStatus.port?` (${e.uploadStatus.port})`:"";t.push(`ì—…ë¡œë“œ: ì„±ê³µ${o}`)}if(e.circuitParts&&e.circuitParts.length>0){const o=e.circuitParts.map(e=>e.label).join(", ");t.push(`ë¶€í’ˆ(${e.circuitParts.length}): ${o}`)}t.length>0&&window.IDEUtils.logToConsole("ğŸ“‹ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„°: "+t.join(" | "))},saveWorkspace(){const e="block"===(window.IDEEditors?window.IDEEditors.currentMode:"block"),t=document.getElementById("fileNameInput"),o=(t?t.value.trim():"")||(e?"arduino_blocks":"arduino_sketch");try{if(e){if(window.IDEEditors&&window.IDEEditors.workspace){let e=[];if(window.IDEBlocklyUtils&&window.IDEBlocklyUtils.detectUnknownBlocksInWorkspace&&(e=window.IDEBlocklyUtils.detectUnknownBlocksInWorkspace(window.IDEEditors.workspace)),e.length>0){const t=e.join(", "),o=window.IDEI18n?window.IDEI18n.getMsg("file_save_unknown_blocks_warning","âš ï¸ ê²½ê³ : ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸”ë¡ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:\n{blockList}\n\nì´ ë¸”ë¡ë“¤ì€ ì½”ë“œë¡œ ë³€í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në¹¨ê°„ìƒ‰ ë¸”ë¡ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë¸”ë¡ìœ¼ë¡œ êµì²´í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\n\nê·¸ë˜ë„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?").replace("{blockList}",t):`âš ï¸ ê²½ê³ : ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸”ë¡ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:\n${t}\n\nì´ ë¸”ë¡ë“¤ì€ ì½”ë“œë¡œ ë³€í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në¹¨ê°„ìƒ‰ ë¸”ë¡ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë¸”ë¡ìœ¼ë¡œ êµì²´í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\n\nê·¸ë˜ë„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;if(!confirm(o))return void window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("file_save_cancelled","ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."):"ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")}}if(!window.IDEEditors||!window.IDEEditors.workspace)throw new Error("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");const e=Blockly.Xml.workspaceToDom(window.IDEEditors.workspace);let t=Blockly.Xml.domToText(e);const n=this.collectProjectMetadata(),i=this.metadataToXml(n);if(t=t.replace("</xml>",i+"</xml>"),console.log("ğŸ’¾ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° í¬í•¨ ì €ì¥:",n.fileName),window.BlockAssemblyRecorder){const e=window.BlockAssemblyRecorder.exportData();if(e&&(e.events.length>0||e.metadata.startTime)){const o=JSON.stringify(e),n=`  <assemblyRecording version="1.0" encoding="base64">${btoa(unescape(encodeURIComponent(o)))}</assemblyRecording>\n`;t=t.replace("</xml>",n+"</xml>"),console.log("ğŸ’¾ ë¸”ë¡ ì¡°ë¦½ ê¸°ë¡ ë°ì´í„° í¬í•¨ ì €ì¥:",e.events.length+"ê°œ ì´ë²¤íŠ¸")}}window.IDEUtils.downloadFile(new Blob([t],{type:"text/xml;charset=utf-8"}),o+".xml"),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("file_save_block","{fileName} ë¸”ë¡ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."):"{fileName} ë¸”ë¡ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.").replace("{fileName}",o+".xml"))}else{if(!window.IDEEditors||!window.IDEEditors.monacoEditor)throw new Error("Monaco ì—ë””í„°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");const e=window.IDEEditors.monacoEditor.getValue();window.IDEUtils.downloadFile(new Blob([e],{type:"text/plain;charset=utf-8"}),o+".ino"),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("file_save_sketch","{fileName} ìŠ¤ì¼€ì¹˜ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."):"{fileName} ìŠ¤ì¼€ì¹˜ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.").replace("{fileName}",o+".ino"))}}catch(t){console.error("íŒŒì¼ ì €ì¥ ì‹¤íŒ¨:",t),window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg(e?"file_save_fail_block":"file_save_fail_sketch","íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},loadWorkspace(e){const t=e.target.files[0];if(!t)return;const o=document.getElementById("fileNameInput");o&&(o.value=t.name.replace(/\.(xml|ino)$/,""));const n=new FileReader;n.onload=e=>{try{const o=t.name.endsWith(".xml");window.IDEEditors&&window.IDEEditors.switchMode&&window.IDEEditors.switchMode(o?"block":"text"),setTimeout(()=>{if(o){if(window.IDEEditors&&window.IDEEditors.workspace){const t=e.target.result;let o,n=[];try{if(window.IDEBlocklyUtils&&window.IDEBlocklyUtils.preprocessXmlForUnknownBlocks){const e=window.IDEBlocklyUtils.preprocessXmlForUnknownBlocks(t);o=e.xmlDom,n=e.unknownBlocks}else o=Blockly.utils.xml.textToDom(t);let e=null;const i=o.getElementsByTagName("assemblyRecording");if(i.length>0)try{const t=i[0],o=t.getAttribute("encoding");let n="";if("base64"===o){const e=t.textContent||t.innerText;n=decodeURIComponent(escape(atob(e)))}else n=t.firstChild?t.firstChild.nodeValue:t.textContent;e=JSON.parse(n),console.log("ğŸ“¥ ë¸”ë¡ ì¡°ë¦½ ê¸°ë¡ ë°ì´í„° ë°œê²¬:",e.events.length+"ê°œ ì´ë²¤íŠ¸"),t.parentNode.removeChild(t)}catch(e){console.warn("ë¸”ë¡ ì¡°ë¦½ ê¸°ë¡ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:",e)}let s=null;const a=o.getElementsByTagName("projectMetadata");if(a.length>0)try{s=window.IDEFileManager.extractProjectMetadata(o),console.log("ğŸ“¥ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° ë°œê²¬:",s),a[0].parentNode.removeChild(a[0])}catch(e){console.warn("í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨:",e)}if(window.IDEEditors.workspace.clear(),Blockly.Xml.domToWorkspace(o,window.IDEEditors.workspace),e&&window.BlockAssemblyRecorder&&(window.BlockAssemblyRecorder.importData(e),window.IDEUtils.logToConsole("ğŸ“¥ ë¸”ë¡ ì¡°ë¦½ ê¸°ë¡ ë¡œë“œ ì™„ë£Œ: "+e.events.length+"ê°œ ì´ë²¤íŠ¸")),s&&window.IDEFileManager.restoreProjectSettings(s),n.length>0){const e=n.join(", "),t=window.IDEI18n?window.IDEI18n.getMsg("file_load_unknown_blocks_warning","íŒŒì¼ì´ ë¡œë“œë˜ì—ˆì§€ë§Œ ë‹¤ìŒ ë¸”ë¡ì€ ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:\n{blockList}\n\në¹¨ê°„ìƒ‰ ë¸”ë¡ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë¸”ë¡ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”.").replace("{blockList}",e):`íŒŒì¼ì´ ë¡œë“œë˜ì—ˆì§€ë§Œ ë‹¤ìŒ ë¸”ë¡ì€ ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:\n${e}\n\në¹¨ê°„ìƒ‰ ë¸”ë¡ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë¸”ë¡ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”.`;window.IDEUtils.logToConsole("âš ï¸ "+t),confirm(t+"\n\ní™•ì¸ì„ ëˆ„ë¥´ë©´ ê³„ì† ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")&&console.log("Unknown blocks detected:",n)}}catch(e){throw e}}}else window.IDEEditors&&window.IDEEditors.monacoEditor&&window.IDEEditors.monacoEditor.setValue(e.target.result);window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg(o?"file_load_block":"file_load_sketch","{fileName} íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."):"{fileName} íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.").replace("{fileName}",t.name))},100)}catch(e){console.error("íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("file_load_fail","íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: {errorMsg}"):"íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",e.message))}},n.readAsText(t,"UTF-8"),e.target.value=""},async copyCode(){try{const e=window.IDEEditors?window.IDEEditors.getCurrentCode():"";return e.trim()?await window.IDEUtils.copyCodeToClipboard(e):(window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("code_copy_no_content","ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤."):"ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),!1)}catch(e){return console.error("ì½”ë“œ ë³µì‚¬ ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("code_copy_fail","í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),!1}},exportProject(e="arduino_project"){try{const t=this.collectProjectMetadata(),o={metadata:{name:e,created:(new Date).toISOString(),version:"1.0.0",board:t.board,language:t.language,ideVersion:t.ideVersion,editorMode:t.editorMode,uploadPort:t.uploadPort,compileStatus:t.compileStatus,uploadStatus:t.uploadStatus},blocklyXml:null,textCode:null,currentMode:window.IDEEditors?window.IDEEditors.currentMode:"block"};window.IDEEditors&&window.IDEEditors.workspace&&(o.blocklyXml=window.IDEEditors.getWorkspaceXml()),window.IDEEditors&&window.IDEEditors.monacoEditor&&(o.textCode=window.IDEEditors.monacoEditor.getValue());const n=JSON.stringify(o,null,2);window.IDEUtils.downloadFile(new Blob([n],{type:"application/json;charset=utf-8"}),e+".json"),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("project_export_success","í”„ë¡œì íŠ¸ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤: {fileName}"):"í”„ë¡œì íŠ¸ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤: {fileName}").replace("{fileName}",e+".json"))}catch(e){console.error("í”„ë¡œì íŠ¸ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("project_export_fail","í”„ë¡œì íŠ¸ ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"í”„ë¡œì íŠ¸ ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},importProject(e){const t=e.target.files[0];if(!t)return;if(!t.name.endsWith(".json"))return void window.IDEUtils.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("project_import_invalid","ì˜¬ë°”ë¥¸ í”„ë¡œì íŠ¸ íŒŒì¼(.json)ì„ ì„ íƒí•´ì£¼ì„¸ìš”."):"ì˜¬ë°”ë¥¸ í”„ë¡œì íŠ¸ íŒŒì¼(.json)ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");const o=new FileReader;o.onload=e=>{try{const o=JSON.parse(e.target.result);if(!o.metadata||!o.currentMode)throw new Error("ì˜¬ë°”ë¥´ì§€ ì•Šì€ í”„ë¡œì íŠ¸ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.");const n=document.getElementById("fileNameInput");n&&o.metadata.name&&(n.value=o.metadata.name);const i=document.getElementById("boardSelect");if(i&&o.metadata.board&&(i.value=o.metadata.board,window.IDEUtils&&window.IDEUtils.updateBoardIndicator)){const e=document.getElementById("boardIndicator");window.IDEUtils.updateBoardIndicator(o.metadata.board,e)}window.IDEEditors&&window.IDEEditors.switchMode&&window.IDEEditors.switchMode(o.currentMode),setTimeout(()=>{o.blocklyXml&&window.IDEEditors&&window.IDEEditors.loadWorkspaceFromXml(o.blocklyXml),o.textCode&&window.IDEEditors&&window.IDEEditors.monacoEditor&&window.IDEEditors.monacoEditor.setValue(o.textCode),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("project_import_success","í”„ë¡œì íŠ¸ê°€ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤: {projectName}"):"í”„ë¡œì íŠ¸ê°€ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤: {projectName}").replace("{projectName}",o.metadata.name||t.name))},200)}catch(e){console.error("í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole((window.IDEI18n?window.IDEI18n.getMsg("project_import_fail","í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: {errorMsg}"):"í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",e.message))}},o.readAsText(t,"UTF-8"),e.target.value=""},enableAutoSave:()=>(console.warn("ìë™ ì €ì¥ ê¸°ëŠ¥ì€ í˜„ì¬ í™˜ê²½ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (localStorage ì œí•œ)"),!1),validateFileContent(e,t){try{switch(t.toLowerCase()){case"xml":return Blockly.utils.xml.textToDom(e),!0;case"ino":return e.includes("setup")||e.includes("loop")||e.trim().length>0;case"json":const t=JSON.parse(e);return t&&"object"==typeof t;default:return!0}}catch(e){return!1}}},window.IDEServerComm={serverUrl:"http://localhost:8080",websocket:null,sketchId:null,compiledBoard:null,lastCompileTimestamp:null,lastUploadSuccess:!1,lastUploadPort:null,lastUploadTimestamp:null,sendLogToServer(e){if(this.websocket&&this.websocket.readyState===WebSocket.OPEN){const t={type:"log",payload:e};this.websocket.send(JSON.stringify(t))}else console.warn("WebSocket is not connected. Log was not sent to the agent.")},logAndSend(e,t=!1){window.IDEUtils.logToConsole(e,t),this.sendLogToServer(e)},logToConsoleOnly(e,t=!1){window.IDEUtils.logToConsole(e,t)},async compileCode(){if(this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_compile_start","ì½”ë“œ ì»´íŒŒì¼ì„ ì‹œì‘í•©ë‹ˆë‹¤."):"ì½”ë“œ ì»´íŒŒì¼ì„ ì‹œì‘í•©ë‹ˆë‹¤."),"function"==typeof window.validateBlockAssembly){const e=window.validateBlockAssembly();if(!e.valid&&(e.errors.forEach(e=>{"incompatible_blocks"===e.type||"duplicate_init"===e.type?this.logAndSend("âŒ "+e.message):this.logAndSend("âš ï¸ "+e.message)}),e.errors.filter(e=>"incompatible_blocks"===e.type||"duplicate_init"===e.type).length>0))return void this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("compile_validation_failed","âŒ ë¸”ë¡ ê²€ì¦ ì‹¤íŒ¨. ìœ„ì˜ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”."):"âŒ ë¸”ë¡ ê²€ì¦ ì‹¤íŒ¨. ìœ„ì˜ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.")}const e=window.IDEEditors?window.IDEEditors.currentMode:"block";this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_compile_mode","í˜„ì¬ ëª¨ë“œ: {modeName}"):"í˜„ì¬ ëª¨ë“œ: {modeName}").replace("{modeName}",e));const t=window.IDEEditors?window.IDEEditors.getCurrentCode():"",o=window.IDEI18n?window.IDEI18n.getMsg("codePreview_initial","// ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´ ì—¬ê¸°ì— ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤."):"// ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´ ì—¬ê¸°ì— ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.";if(!t.trim()||t.includes(o))return void this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_compile_no_code","ì»´íŒŒì¼í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤."):"ì»´íŒŒì¼í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");const n=document.getElementById("compileBtn"),i=document.getElementById("uploadBtn");n&&(n.disabled=!0),i&&(i.disabled=!0);try{const e=document.getElementById("boardSelect"),o=e?e.value:"uno";if(console.log("ğŸ” ì»´íŒŒì¼ ìš”ì²­ ì •ë³´:",{board:o,codeLength:t.length,codePreview:t.substring(0,200)+"..."}),!await this.checkAgentConnection())return void this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_compile_no_connection","âŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”."):"âŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");const n=await fetch(`${this.serverUrl}/api/compile`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({code:t,board:o,autoInstallLibs:!0})});if(!n.ok){const e=await n.json().catch(()=>({}));throw console.error("ì»´íŒŒì¼ ì‹¤íŒ¨ ìƒì„¸:",e),new Error(`HTTP ${n.status}: ${e.error||n.statusText}`)}const s=await n.json();if(s.success){this.sketchId=s.sketchId,this.compiledBoard=s.board,this.lastCompileTimestamp=(new Date).toISOString(),i&&(i.disabled=!1);const e=s.size?window.IDEUtils.formatBytes(s.size):window.IDEI18n?window.IDEI18n.getMsg("unknown","ì•Œ ìˆ˜ ì—†ìŒ"):"ì•Œ ìˆ˜ ì—†ìŒ",t=s.memoryUsage?(window.IDEI18n?window.IDEI18n.getMsg("memory_usage"," (ë©”ëª¨ë¦¬ {percent}% ì‚¬ìš©)"):" (ë©”ëª¨ë¦¬ {percent}% ì‚¬ìš©)").replace("{percent}",s.memoryUsage):"";this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_compile_success","âœ… ì»´íŒŒì¼ ì™„ë£Œ! í¬ê¸°: {size}"):"âœ… ì»´íŒŒì¼ ì™„ë£Œ! í¬ê¸°: {size}").replace("{size}",e+t)),window.IDEAnalytics&&window.IDEAnalytics.captureSessionEvent("compile_success",{codeSize:s.size||0})}else{const e=s.error||(window.IDEI18n?window.IDEI18n.getMsg("unknown_error","ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"):"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_compile_fail","âŒ ì»´íŒŒì¼ ì‹¤íŒ¨: {errorMsg}"):"âŒ ì»´íŒŒì¼ ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",e)),window.IDEAnalytics&&window.IDEAnalytics.captureSessionEvent("compile_error",{errorMessage:e})}}catch(e){console.error("ì»´íŒŒì¼ ìš”ì²­ ì‹¤íŒ¨:",e);let t=e.message;e.message.includes("fetch")&&(t=window.IDEI18n?window.IDEI18n.getMsg("agent_upload_no_connection","PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_compile_request_fail","âŒ ì»´íŒŒì¼ ìš”ì²­ ì‹¤íŒ¨: {errorMsg}"):"âŒ ì»´íŒŒì¼ ìš”ì²­ ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",t))}finally{n&&(n.disabled=!1)}},async uploadCode(){if(!this.sketchId)return void this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_upload_need_compile","ì—…ë¡œë“œí•˜ê¸° ì „ì— ë¨¼ì € ì»´íŒŒì¼ì„ í•´ì£¼ì„¸ìš”."):"ì—…ë¡œë“œí•˜ê¸° ì „ì— ë¨¼ì € ì»´íŒŒì¼ì„ í•´ì£¼ì„¸ìš”.");const e=document.getElementById("uploadBtn");e&&(e.disabled=!0);try{const e=document.getElementById("boardSelect"),t=document.getElementById("portSelect"),o={sketchId:this.sketchId,board:e?e.value:"uno",port:t&&t.value||null},n=await fetch(`${this.serverUrl}/api/upload`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const i=await n.json();i.success?(this.lastUploadSuccess=!0,this.lastUploadPort=t&&t.value||"auto",this.lastUploadTimestamp=(new Date).toISOString(),this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_upload_request_sent","ğŸ“¤ ì—…ë¡œë“œ ìš”ì²­ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤."):"ğŸ“¤ ì—…ë¡œë“œ ìš”ì²­ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤."),window.IDEAnalytics&&window.IDEAnalytics.captureSessionEvent("upload_success")):(this.lastUploadSuccess=!1,this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_upload_fail","âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: {errorMsg}"):"âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",i.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜")),window.IDEAnalytics&&window.IDEAnalytics.captureSessionEvent("upload_error"))}catch(e){console.error("ì—…ë¡œë“œ ìš”ì²­ ì‹¤íŒ¨:",e);let t=e.message;e.message.includes("fetch")&&(t=window.IDEI18n?window.IDEI18n.getMsg("agent_upload_no_connection","PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_upload_request_fail","âŒ ì—…ë¡œë“œ ìš”ì²­ ì‹¤íŒ¨: {errorMsg}"):"âŒ ì—…ë¡œë“œ ìš”ì²­ ì‹¤íŒ¨: {errorMsg}").replace("{errorMsg}",t))}finally{setTimeout(()=>{e&&(e.disabled=!1)},2e3)}},async requestPorts(){try{this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_port_request","ğŸ” í¬íŠ¸ ëª©ë¡ì„ ìš”ì²­í•©ë‹ˆë‹¤..."):"ğŸ” í¬íŠ¸ ëª©ë¡ì„ ìš”ì²­í•©ë‹ˆë‹¤...");const e=await fetch(`${this.serverUrl}/api/ports`,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();t.success&&t.ports?this.updatePortList(t.ports):this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_port_not_available","âš ï¸ í¬íŠ¸ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤."):"âš ï¸ í¬íŠ¸ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.")}catch(e){console.error("í¬íŠ¸ ìš”ì²­ ì‹¤íŒ¨:",e);let t=e.message;e.message.includes("fetch")&&(t=window.IDEI18n?window.IDEI18n.getMsg("agent_upload_no_connection","PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),this.logAndSend(window.IDEI18n?window.IDEI18n.getMsg("agent_port_request_fail","í¬íŠ¸ ëª©ë¡ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"í¬íŠ¸ ëª©ë¡ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},updatePortList(e){const t=document.getElementById("portSelect");if(!t)return;const o=t.value,n=window.IDEI18n?window.IDEI18n.getMsg("portAutoSelect","í¬íŠ¸ ìë™ ì„ íƒ"):"í¬íŠ¸ ìë™ ì„ íƒ";t.innerHTML=`<option value="">${n}</option>`,e.forEach(e=>{const o=document.createElement("option");o.value=e.path,o.textContent=`${e.path} (${e.name})`,t.appendChild(o)}),e.some(e=>e.path===o)&&(t.value=o),this.logAndSend((window.IDEI18n?window.IDEI18n.getMsg("agent_port_list_updated","í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ ({portCount}ê°œ)"):"í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ ({portCount}ê°œ)").replace("{portCount}",e.length))},initWebSocket(){try{const e="ws://localhost:8081";this.websocket=new WebSocket(e),this.websocket.onopen=()=>{this.logToConsoleOnly(window.IDEI18n?window.IDEI18n.getMsg("websocket_connected","ğŸŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."):"ğŸŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.")},this.websocket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleWebSocketMessage(t)}catch(t){this.logToConsoleOnly(e.data,!0)}},this.websocket.onclose=()=>{this.logToConsoleOnly(window.IDEI18n?window.IDEI18n.getMsg("websocket_disconnected","ğŸ”Œ PC ì—ì´ì „íŠ¸ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤."):"ğŸ”Œ PC ì—ì´ì „íŠ¸ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.")},this.websocket.onerror=()=>{this.logToConsoleOnly(window.IDEI18n?window.IDEI18n.getMsg("websocket_error","âŒ PC ì—ì´ì „íŠ¸ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."):"âŒ PC ì—ì´ì „íŠ¸ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}catch(e){console.warn("WebSocket ì—°ê²° ì‹¤íŒ¨:",e),this.logToConsoleOnly(window.IDEI18n?window.IDEI18n.getMsg("websocket_unavailable","âš ï¸ ì‹¤ì‹œê°„ í†µì‹ ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"âš ï¸ ì‹¤ì‹œê°„ í†µì‹ ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}},handleWebSocketMessage(e){switch(e.type){case"port-list":this.updatePortList(e.payload);break;case"compile-progress":this.logToConsoleOnly((window.IDEI18n?window.IDEI18n.getMsg("compile_progress","ğŸ”„ ì»´íŒŒì¼ ì§„í–‰: {message}"):"ğŸ”„ ì»´íŒŒì¼ ì§„í–‰: {message}").replace("{message}",e.payload.message));break;case"upload-progress":this.logToConsoleOnly((window.IDEI18n?window.IDEI18n.getMsg("upload_progress","ğŸ“¤ ì—…ë¡œë“œ ì§„í–‰: {message}"):"ğŸ“¤ ì—…ë¡œë“œ ì§„í–‰: {message}").replace("{message}",e.payload.message));break;case"error":this.logToConsoleOnly((window.IDEI18n?window.IDEI18n.getMsg("agent_error","âŒ ì˜¤ë¥˜: {message}"):"âŒ ì˜¤ë¥˜: {message}").replace("{message}",e.payload.message));break;case"log":this.logToConsoleOnly(e.payload.message,e.payload.raw||!1);break;default:console.log("ì•Œ ìˆ˜ ì—†ëŠ” WebSocket ë©”ì‹œì§€:",e)}},async checkAgentConnection(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=await fetch(`${this.serverUrl}/api/health`,{method:"GET",signal:e.signal,headers:{Accept:"application/json"}});if(clearTimeout(t),o.ok){const e=!0===(await o.json()).success;return window.updateAgentStatus&&window.updateAgentStatus(e),e}return window.updateAgentStatus&&window.updateAgentStatus(!1),!1}catch(e){return console.warn("PC ì—ì´ì „íŠ¸ ì—°ê²° í™•ì¸ ì‹¤íŒ¨:",e.message),window.updateAgentStatus&&window.updateAgentStatus(!1),!1}},closeWebSocket(){if(this.websocket)try{this.websocket.readyState!==WebSocket.OPEN&&this.websocket.readyState!==WebSocket.CONNECTING||this.websocket.close()}catch(e){console.warn("WebSocket ì¢…ë£Œ ê²½ê³ :",e.message)}finally{this.websocket=null}},setServerUrl(e){this.serverUrl=e,console.log("PC ì—ì´ì „íŠ¸ URL ë³€ê²½ë¨:",e)}},window.IDEShare={_API_BASE:"https://www.gorillacell.kr/code_share/",_currentShareLink:null,_loadedShareId:null,_shareStep:1,serializeProject(){try{if(!window.IDEEditors||!window.IDEEditors.workspace)return null;const e={v:1,b:document.getElementById("boardSelect")?.value||"uno",m:window.IDEEditors.currentMode||"block",x:null,t:null};window.IDEEditors.workspace&&(e.x=window.IDEEditors.getWorkspaceXml()),window.IDEEditors.monacoEditor&&(e.t=window.IDEEditors.monacoEditor.getValue());const t=JSON.stringify(e);return"undefined"!=typeof LZString?LZString.compressToEncodedURIComponent(t):btoa(unescape(encodeURIComponent(t)))}catch(e){return console.error("[IDEShare] í”„ë¡œì íŠ¸ ì§ë ¬í™” ì‹¤íŒ¨:",e),null}},deserializeProject(e){try{let t;if("undefined"!=typeof LZString&&(t=LZString.decompressFromEncodedURIComponent(e)),!t)try{t=decodeURIComponent(escape(atob(e)))}catch(e){return null}const o=JSON.parse(t);return o&&o.v?o:null}catch(e){return console.error("[IDEShare] í”„ë¡œì íŠ¸ ë³µì› ì‹¤íŒ¨:",e),null}},generateHashLink(){const e=this.serializeProject();return e?window.location.origin+window.location.pathname+"#project="+e:null},generateShareLink(){return this._currentShareLink?this._currentShareLink:this.generateHashLink()},generateEmbedCode(e={}){const t=this.generateShareLink();return t?`<iframe src="${t}" width="${e.width||800}" height="${e.height||500}" frameborder="0" allowfullscreen style="border:1px solid #e5e7eb;border-radius:8px;"></iframe>`:null},getSocialShareUrl(e){const t=this.generateShareLink();if(!t)return null;const o=document.getElementById("fileNameInput")?.value||"Brixel Block Project",n=window.IDEI18n?window.IDEI18n.getMsg("share_social_text","Brixel ë¸”ë¡ì½”ë”©ìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!"):"Brixel ë¸”ë¡ì½”ë”©ìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!",i=encodeURIComponent(t),s=encodeURIComponent(n+" - "+o);switch(e){case"twitter":return`https://twitter.com/intent/tweet?text=${s}&url=${i}`;case"facebook":return`https://www.facebook.com/sharer/sharer.php?u=${i}`;case"kakaotalk":return`https://story.kakao.com/share?url=${i}`;case"classroom":return`https://classroom.google.com/share?url=${i}`;case"teams":return`https://teams.microsoft.com/share?href=${i}&msgText=${s}`;case"whatsapp":return`https://api.whatsapp.com/send?text=${s}%20${i}`;default:return t}},checkRateLimit(){try{let e=JSON.parse(localStorage.getItem("_brixel_share_rl")||'{"timestamps":[]}');const t=Math.floor(Date.now()/1e3),o=t-3600;if(e.timestamps=e.timestamps.filter(e=>e>o),e.timestamps.length>=20)return{allowed:!1,wait:0,error:"hourly"};if(e.timestamps.length>0){const o=e.timestamps[e.timestamps.length-1];if(t-o<10)return{allowed:!1,wait:10-(t-o),error:"wait"}}return{allowed:!0}}catch(e){return{allowed:!0}}},_recordRateLimit(){const e="_brixel_share_rl";try{let t=JSON.parse(localStorage.getItem(e)||'{"timestamps":[]}');t.timestamps.push(Math.floor(Date.now()/1e3)),localStorage.setItem(e,JSON.stringify(t))}catch(e){}},async _uploadToAPI(e,t,o,n){try{const i=await fetch(this._API_BASE+"save.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,data:t,board:o,mode:n})});if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.json()}catch(e){return console.error("[IDEShare] API ì—…ë¡œë“œ ì‹¤íŒ¨:",e),{success:!1,error:e.message}}},async _loadFromAPI(e){try{const t=await fetch(this._API_BASE+"load.php?id="+encodeURIComponent(e));if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(e){return console.error("[IDEShare] API ë¡œë“œ ì‹¤íŒ¨:",e),{success:!1,error:e.message}}},_getShareIdFromUrl:()=>new URLSearchParams(window.location.search).get("s")||null,checkUrlForSharedProject(){const e=this._getShareIdFromUrl();if(e)return setTimeout(()=>{this._loadSharedProject(e)},500),!0;try{const e=window.location.hash;if(!e||!e.includes("#project="))return!1;const t=e.replace("#project=","");if(!t)return!1;const o=this.deserializeProject(t);return o?(setTimeout(()=>{this.restoreSharedProject(o)},500),!0):(console.warn("[IDEShare] ê³µìœ  í”„ë¡œì íŠ¸ ë°ì´í„° ë³µì› ì‹¤íŒ¨"),!1)}catch(e){return console.error("[IDEShare] ê³µìœ  í”„ë¡œì íŠ¸ í™•ì¸ ì‹¤íŒ¨:",e),!1}},async _loadSharedProject(e){try{const t=await this._loadFromAPI(e);if(!t.success||!t.project)return console.warn("[IDEShare] í”„ë¡œì íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:",t.error),void window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_cloud_load_fail","í´ë¼ìš°ë“œ í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"í´ë¼ìš°ë“œ í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const o=t.project;this._loadedShareId=e;const n=this.deserializeProject(o.data);if(!n)return console.warn("[IDEShare] í”„ë¡œì íŠ¸ ë°ì´í„° ì—­ì§ë ¬í™” ì‹¤íŒ¨"),void window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_project_load_fail","ê³µìœ  í”„ë¡œì íŠ¸ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"ê³µìœ  í”„ë¡œì íŠ¸ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");const i=document.getElementById("fileNameInput");if(i&&o.title){const e=document.createElement("span");e.innerHTML=o.title,i.value=e.textContent}if(this.restoreSharedProject(n),history.replaceState){const e=new URL(window.location);e.searchParams.delete("s"),history.replaceState(null,null,e.pathname+e.search)}}catch(e){console.error("[IDEShare] ê³µìœ  í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:",e)}},restoreSharedProject(e){try{if(e.b){const t=document.getElementById("boardSelect");t&&(t.value=e.b,t.dispatchEvent(new Event("change")));const o=document.getElementById("boardIndicator");o&&window.IDEUtils&&window.IDEUtils.updateBoardIndicator&&window.IDEUtils.updateBoardIndicator(e.b,o),"undefined"!=typeof Arduino&&(Arduino.selectedBoard=e.b)}e.m&&window.IDEEditors&&window.IDEEditors.switchMode&&window.IDEEditors.switchMode(e.m),setTimeout(()=>{e.x&&window.IDEEditors&&window.IDEEditors.loadWorkspaceFromXml(e.x),e.t&&window.IDEEditors&&window.IDEEditors.monacoEditor&&window.IDEEditors.monacoEditor.setValue(e.t),window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_project_loaded","ê³µìœ ëœ í”„ë¡œì íŠ¸ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."):"ê³µìœ ëœ í”„ë¡œì íŠ¸ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."),window.location.hash&&history.replaceState&&history.replaceState(null,null,window.location.pathname+window.location.search)},200)}catch(e){console.error("[IDEShare] ê³µìœ  í”„ë¡œì íŠ¸ ë³µì› ì‹¤íŒ¨:",e),window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_project_load_fail","ê³µìœ  í”„ë¡œì íŠ¸ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"ê³µìœ  í”„ë¡œì íŠ¸ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},openShareModal(){if(window.IDEEditors&&window.IDEEditors.workspace&&0===window.IDEEditors.workspace.getAllBlocks(!1).length)return void window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_no_blocks","ê³µìœ í•  ë¸”ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¸”ë¡ì„ ë°°ì¹˜í•´ì£¼ì„¸ìš”."):"ê³µìœ í•  ë¸”ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¸”ë¡ì„ ë°°ì¹˜í•´ì£¼ì„¸ìš”.");const e=document.getElementById("shareModal");if(!e)return;this._currentShareLink=null,this._shareStep=1;const t=document.getElementById("shareStep1"),o=document.getElementById("shareStep2");t&&t.classList.add("active"),o&&o.classList.remove("active");const n=document.getElementById("shareBlockCount");if(n&&window.IDEEditors&&window.IDEEditors.workspace){const e=window.IDEEditors.workspace.getAllBlocks(!1).length,t=window.IDEI18n?window.IDEI18n.getMsg("share_block_count_text","ë¸”ë¡ {count}ê°œ").replace("{count}",e):`ë¸”ë¡ ${e}ê°œ`;n.textContent=t}const i=document.getElementById("shareTitleInput"),s=document.getElementById("fileNameInput");i&&(i.value=s?.value||"");const a=document.getElementById("shareStatusMsg");a&&(a.textContent="",a.className="share-status-msg");const r=document.getElementById("sharePublishBtn");r&&(r.disabled=!1),e.classList.add("active")},async publishProject(){const e=document.getElementById("sharePublishBtn"),t=document.getElementById("shareStatusMsg"),o=this.checkRateLimit();if(!o.allowed){if(t){const e="hourly"===o.error?window.IDEI18n?window.IDEI18n.getMsg("share_rate_limit_hourly","ì‹œê°„ë‹¹ ê³µìœ  íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."):"ì‹œê°„ë‹¹ ê³µìœ  íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.":window.IDEI18n?window.IDEI18n.getMsg("share_rate_limit_wait","{wait}ì´ˆ í›„ì— ë‹¤ì‹œ ê³µìœ í•´ì£¼ì„¸ìš”.").replace("{wait}",o.wait):`${o.wait}ì´ˆ í›„ì— ë‹¤ì‹œ ê³µìœ í•´ì£¼ì„¸ìš”.`;t.textContent=e,t.className="share-status-msg error"}return}e&&(e.disabled=!0),t&&(t.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_uploading","ì—…ë¡œë“œ ì¤‘..."):"ì—…ë¡œë“œ ì¤‘...",t.className="share-status-msg loading");const n=document.getElementById("shareTitleInput")?.value?.trim()||"Untitled Project",i=document.getElementById("boardSelect")?.value||"uno",s=window.IDEEditors?.currentMode||"block",a=this.serializeProject();if(!a)return t&&(t.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_generate_fail","ê³µìœ  ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"ê³µìœ  ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",t.className="share-status-msg error"),void(e&&(e.disabled=!1));const r=await this._uploadToAPI(n,a,i,s),l=document.getElementById("shareLinkWarning");if(r.success&&r.id){const e=window.location.origin+window.location.pathname;this._currentShareLink=e+"?s="+r.id,this._recordRateLimit(),l&&(l.style.display="none")}else console.warn("[IDEShare] API ì—…ë¡œë“œ ì‹¤íŒ¨, í•´ì‹œ í´ë°±:",r.error),this._currentShareLink=this.generateHashLink(),t&&(t.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_upload_fail","ì„œë²„ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. URL ë§í¬ ë°©ì‹ìœ¼ë¡œ ê³µìœ í•©ë‹ˆë‹¤."):"ì„œë²„ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. URL ë§í¬ ë°©ì‹ìœ¼ë¡œ ê³µìœ í•©ë‹ˆë‹¤.",t.className="share-status-msg error"),l&&this._currentShareLink&&this._currentShareLink.length>2e3?(l.style.display="block",l.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_url_long_warning","í”„ë¡œì íŠ¸ê°€ ì»¤ì„œ ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ë§í¬ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."):"í”„ë¡œì íŠ¸ê°€ ì»¤ì„œ ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ë§í¬ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."):l&&(l.style.display="none");this._shareStep=2;const d=document.getElementById("shareStep1"),c=document.getElementById("shareStep2");d&&d.classList.remove("active"),c&&c.classList.add("active");const w=document.getElementById("shareLinkInput");w&&(w.value=this._currentShareLink||"");const p=document.getElementById("shareEmbedInput");p&&(p.value=this.generateEmbedCode()||"")},closeShareModal(){const e=document.getElementById("shareModal");e&&e.classList.remove("active"),this._shareStep=1},async copyShareLink(){const e=document.getElementById("shareLinkInput");if(e&&e.value)try{await navigator.clipboard.writeText(e.value);const t=document.getElementById("shareCopyLinkBtn");if(t){const e=t.querySelector("span"),o=e?e.textContent:t.textContent;e?(e.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_copied","ë³µì‚¬ë¨!"):"ë³µì‚¬ë¨!",setTimeout(()=>{e.textContent=o},2e3)):(t.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_copied","ë³µì‚¬ë¨!"):"ë³µì‚¬ë¨!",setTimeout(()=>{t.textContent=o},2e3))}}catch(t){e.select(),document.execCommand("copy")}},async copyEmbedCode(){const e=document.getElementById("shareEmbedInput");if(e&&e.value)try{await navigator.clipboard.writeText(e.value);const t=document.getElementById("shareCopyEmbedBtn");if(t){const e=t.querySelector("span"),o=e?e.textContent:t.textContent;e?(e.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_copied","ë³µì‚¬ë¨!"):"ë³µì‚¬ë¨!",setTimeout(()=>{e.textContent=o},2e3)):(t.textContent=window.IDEI18n?window.IDEI18n.getMsg("share_copied","ë³µì‚¬ë¨!"):"ë³µì‚¬ë¨!",setTimeout(()=>{t.textContent=o},2e3))}}catch(t){e.select(),document.execCommand("copy")}},shareToSocial(e){if("webshare"===e)return void this._webShare();if("embed"===e)return void this.copyEmbedCode();if("clipboard"===e)return void this.copyShareLink();const t=this.getSocialShareUrl(e);if(!t)return;const o=(screen.width-600)/2,n=(screen.height-400)/2;window.open(t,"share",`width=600,height=400,left=${o},top=${n},toolbar=no,menubar=no`)},async _webShare(){const e=this.generateShareLink();if(!e)return;const t=document.getElementById("shareTitleInput")?.value||document.getElementById("fileNameInput")?.value||"Brixel Block Project",o=window.IDEI18n?window.IDEI18n.getMsg("share_social_text","Brixel ë¸”ë¡ì½”ë”©ìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!"):"Brixel ë¸”ë¡ì½”ë”©ìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!";if(navigator.share)try{await navigator.share({title:t,text:o,url:e})}catch(e){"AbortError"!==e.name&&console.warn("[IDEShare] Web Share ì‹¤íŒ¨:",e)}else try{await navigator.clipboard.writeText(e),window.IDEUtils?.logToConsole(window.IDEI18n?window.IDEI18n.getMsg("share_webshare_fail","ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."):"ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(e){}},initialize(){this.checkUrlForSharedProject();const e=document.getElementById("shareModal");e&&e.addEventListener("click",t=>{t.target===e&&this.closeShareModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeShareModal()}),console.log("[IDEShare] ê³µìœ  ëª¨ë“ˆ ì´ˆê¸°í™” ì™„ë£Œ")}};class IntegratedArduinoIDE{constructor(){this.currentMode="block",this.serverUrl="http://localhost:8080",this.elements={},this.initElements(),this.initEventListeners(),this.initialize()}initElements(){this.elements=window.IDEUtils.cacheElements(["blockModeBtn","textModeBtn","editorArea","blocklyPanel","monacoEditor","codePreview","languageSelect","languageStatus","compileBtn","uploadBtn","boardSelect","boardIndicator","portSelect","refreshPortsBtn","consoleOutput","copyBtn","saveBtn","loadBtn","loadFile","fileNameInput","codeTitle","agentStatusIndicator","loadingText","shareBtn","aiBtn","aiChatPanel"])}initEventListeners(){this.elements.blockModeBtn&&this.elements.blockModeBtn.addEventListener("click",()=>this.switchMode("block")),this.elements.textModeBtn&&this.elements.textModeBtn.addEventListener("click",()=>this.switchMode("text")),this.elements.languageSelect&&this.elements.languageSelect.addEventListener("change",e=>this.changeLanguage(e.target.value)),this.elements.saveBtn&&this.elements.saveBtn.addEventListener("click",()=>this.saveWorkspace()),this.elements.loadBtn&&this.elements.loadBtn.addEventListener("click",()=>this.elements.loadFile.click()),this.elements.loadFile&&this.elements.loadFile.addEventListener("change",e=>this.loadWorkspace(e)),this.elements.copyBtn&&this.elements.copyBtn.addEventListener("click",()=>this.copyCode()),this.elements.boardSelect&&this.elements.boardSelect.addEventListener("change",()=>{const e=this.elements.boardSelect.value;this.updateBoardIndicator(),this.updateEditorTemplate(),window.IDEEditors.updateToolbox(e),window.IDEAnalytics&&window.IDEAnalytics.captureSessionEvent("board_changed",{blockType:e})}),this.elements.compileBtn&&this.elements.compileBtn.addEventListener("click",()=>this.compileCode()),this.elements.uploadBtn&&this.elements.uploadBtn.addEventListener("click",()=>this.uploadCode()),this.elements.refreshPortsBtn&&this.elements.refreshPortsBtn.addEventListener("click",()=>this.requestPorts()),this.elements.shareBtn&&this.elements.shareBtn.addEventListener("click",()=>{window.IDEShare&&window.IDEShare.openShareModal()})}async initialize(){try{if(console.log("=== ì •ì  ì›¹ IDE ì´ˆê¸°í™” ì‹œì‘ ==="),await window.IDEI18n.initialize(),await window.IDEUtils.delay(100),"function"==typeof window.defineArduinoBlocks&&window.defineArduinoBlocks(),await window.IDEEditors.initializeBlockly(),this.updateBoardIndicator(),window.IDEI18n.updateUITexts(),await this.checkAgentConnection(),window.IDEServerComm.initWebSocket(),window.IDEShare&&window.IDEShare.initialize(),window.IDEAnalytics)if(window.IDEAnalytics.hasConsent()){const e=window.IDEEditors&&window.IDEEditors.workspace;e&&await window.IDEAnalytics.init(e)}else setTimeout(()=>{window.IDEAnalytics&&window.IDEAnalytics.showConsentDialog()},3e3);window.IDEAIEngine&&console.log("[Core] AI Engine module registered (lazy load)"),window.IDEUtils.logToConsole(window.IDEI18n.getMsg("system_ready","âœ… ì •ì  ì›¹ Arduino IDE ì´ˆê¸°í™” ì™„ë£Œ"))}catch(e){console.error("ì´ˆê¸°í™” ì‹¤íŒ¨:",e),window.IDEUtils.logToConsole(window.IDEI18n.getMsg("system_init_fail","âš ï¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}finally{const e=document.getElementById("loadingOverlay");e&&e.classList.add("hidden")}}async checkAgentConnection(){try{const e=await window.IDEServerComm.checkAgentConnection(),t=this.elements.agentStatusIndicator||document.getElementById("agentStatusIndicator");return t&&(e?(t.textContent="ğŸŸ¢ ì—°ê²°ë¨",t.className="agent-status connected",window.IDEUtils.logToConsole(window.IDEI18n.getMsg("agent_connected","ğŸ”— PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."))):(t.textContent="ğŸ”´ ì—°ê²° ì•ˆë¨",t.className="agent-status disconnected",window.IDEUtils.logToConsole(window.IDEI18n.getMsg("agent_not_found","âš ï¸ PC ì—ì´ì „íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•´ì£¼ì„¸ìš”.")))),e}catch(e){return console.error("ì—ì´ì „íŠ¸ ì—°ê²° í™•ì¸ ì‹¤íŒ¨:",e),!1}}async changeLanguage(e){await window.IDEI18n.changeLanguage(e)}switchMode(e){this.currentMode=e,window.IDEEditors.currentMode=e,window.IDEEditors.switchMode(e)}saveWorkspace(){window.IDEFileManager.saveWorkspace()}loadWorkspace(e){window.IDEFileManager.loadWorkspace(e)}copyCode(){window.IDEFileManager.copyCode()}async compileCode(){await this.checkAgentConnection()?window.IDEServerComm.compileCode():window.IDEUtils.logToConsole(window.IDEI18n.getMsg("agent_connection_required","âŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”."))}async uploadCode(){await this.checkAgentConnection()?window.IDEServerComm.uploadCode():window.IDEUtils.logToConsole(window.IDEI18n.getMsg("agent_connection_required","âŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”."))}async requestPorts(){await this.checkAgentConnection()?window.IDEServerComm.requestPorts():window.IDEUtils.logToConsole(window.IDEI18n.getMsg("agent_connection_required","âŒ PC ì—ì´ì „íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—ì´ì „íŠ¸ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”."))}updateBoardIndicator(){const e=this.elements.boardSelect?this.elements.boardSelect.value:"uno";window.IDEUtils.updateBoardIndicator(e,this.elements.boardIndicator)}updateEditorTemplate(){const e=this.elements.boardSelect?this.elements.boardSelect.value:"uno";"undefined"!=typeof Arduino&&(Arduino.selectedBoard=e,console.log(`[IDE] Selected Board set to Generator: ${e}`)),window.IDEEditors.updateEditorTemplate(e)}getCurrentCode(){return window.IDEEditors.getCurrentCode()}logToConsole(e,t=!1){window.IDEUtils.logToConsole(e,t)}getMsg(e,t=e){return window.IDEI18n.getMsg(e,t)}getSystemInfo(){return{version:"2.0.0",mode:"static",currentMode:this.currentMode,currentLanguage:window.IDEI18n.getCurrentLanguage(),hasBlocklyWorkspace:!(!window.IDEEditors||!window.IDEEditors.workspace),hasMonacoEditor:!(!window.IDEEditors||!window.IDEEditors.monacoEditor),isWebSocketConnected:!(!window.IDEServerComm||!window.IDEServerComm.websocket),agentUrl:window.IDEServerComm?window.IDEServerComm.serverUrl:this.serverUrl}}cleanup(){try{if(window.IDEServerComm&&window.IDEServerComm.closeWebSocket(),window.IDEEditors&&window.IDEEditors.workspace)try{window.IDEEditors.workspace.isDisposed||window.IDEEditors.workspace.dispose()}catch(e){console.warn("Workspace dispose ê²½ê³ :",e.message)}if(window.IDEEditors&&window.IDEEditors.monacoEditor)try{window.IDEEditors.monacoEditor.dispose()}catch(e){console.warn("Monaco editor dispose ê²½ê³ :",e.message)}console.log("IDE ì •ë¦¬ ì™„ë£Œ")}catch(e){console.error("IDE ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:",e)}}}document.addEventListener("DOMContentLoaded",()=>{const e=()=>{const o="undefined"!=typeof Blockly&&window.blocklyLoaded,n=window.brixelScriptsLoaded;o&&n?(console.log("âœ… ëª¨ë“  ì˜ì¡´ì„± ë¡œë”© ì™„ë£Œ, IDE ì´ˆê¸°í™” ì‹œì‘"),t()):(o||console.log("â³ Blockly ë¡œë”© ëŒ€ê¸° ì¤‘..."),n||console.log("â³ Brixel ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ëŒ€ê¸° ì¤‘..."),setTimeout(e,100))},t=()=>{try{window.arduinoIDE=new IntegratedArduinoIDE,window.addEventListener("beforeunload",e=>{window.isDownloading||window.arduinoIDE&&window.arduinoIDE.cleanup()}),console.log("âœ… ì •ì  ì›¹ IDE ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ (Monaco ì§€ì—° ë¡œë”© ëª¨ë“œ)")}catch(e){console.error("âŒ IDE ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:",e)}};e()});