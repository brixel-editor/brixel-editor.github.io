window.CDNFallbackLoader={cdnSources:{blockly:["https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0","https://cdn.jsdelivr.net/npm/blockly@12.2.0/dist","https://unpkg.com/blockly@12.2.0/dist"],monaco:["https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min","https://cdn.jsdelivr.net/npm/monaco-editor@0.34.0/min","https://unpkg.com/monaco-editor@0.34.0/min"]},loadedLibraries:{blockly:!1,monacoLoader:!1,monacoCss:!1},currentCdnIndex:{blockly:0,monaco:0},loadScript:(o,e=1e4)=>new Promise((n,r)=>{const c=document.createElement("script");c.src=o,c.async=!0;const l=setTimeout(()=>{c.remove(),r(new Error(`Script load timeout: ${o}`))},e);c.onload=()=>{clearTimeout(l),n()},c.onerror=()=>{clearTimeout(l),c.remove(),r(new Error(`Script load failed: ${o}`))},document.head.appendChild(c)}),loadCSS:(o,e="")=>new Promise((n,r)=>{if(document.querySelector(`link[href="${o}"]`))return void n();const c=document.createElement("link");c.rel="stylesheet",c.href=o,e&&c.setAttribute("data-name",e),c.onload=()=>n(),c.onerror=()=>r(new Error(`CSS load failed: ${o}`)),document.head.appendChild(c)}),async loadBlockly(o="ko"){if(this.loadedLibraries.blockly&&"undefined"!=typeof Blockly)return console.log("âœ… Blockly ì´ë¯¸ ë¡œë“œë¨"),!0;const e=["blockly_compressed.js","blocks_compressed.js","javascript_compressed.js",`msg/${o}.js`];for(let o=0;o<this.cdnSources.blockly.length;o++){const n=this.cdnSources.blockly[o];console.log(`ğŸ”„ Blockly ë¡œë“œ ì‹œë„ (CDN ${o+1}): ${n}`);try{for(const o of e)await this.loadScript(`${n}/${o}`);if("undefined"!=typeof Blockly)return this.loadedLibraries.blockly=!0,this.currentCdnIndex.blockly=o,console.log(`âœ… Blockly ë¡œë“œ ì„±ê³µ (CDN ${o+1}): ${n}`),!0}catch(e){console.warn(`âš ï¸ Blockly ë¡œë“œ ì‹¤íŒ¨ (CDN ${o+1}):`,e.message)}}return console.error("âŒ ëª¨ë“  Blockly CDN ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨"),this.showLoadError("Blockly"),!1},async loadMonaco(){if(this.loadedLibraries.monacoLoader&&"undefined"!=typeof require&&require.config)return console.log("âœ… Monaco loader ì´ë¯¸ ë¡œë“œë¨"),!0;for(let o=0;o<this.cdnSources.monaco.length;o++){const e=this.cdnSources.monaco[o];console.log(`ğŸ”„ Monaco ë¡œë“œ ì‹œë„ (CDN ${o+1}): ${e}`);try{if(this.loadedLibraries.monacoCss||(await this.loadCSS(`${e}/vs/editor/editor.main.css`,"vs/editor/editor.main"),this.loadedLibraries.monacoCss=!0),await this.loadScript(`${e}/vs/loader.min.js`),"undefined"!=typeof require&&require.config)return require.config({paths:{vs:`${e}/vs`}}),this.loadedLibraries.monacoLoader=!0,this.currentCdnIndex.monaco=o,console.log(`âœ… Monaco loader ë¡œë“œ ì„±ê³µ (CDN ${o+1}): ${e}`),!0}catch(e){console.warn(`âš ï¸ Monaco ë¡œë“œ ì‹¤íŒ¨ (CDN ${o+1}):`,e.message)}}return console.error("âŒ ëª¨ë“  Monaco CDN ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨"),this.showLoadError("Monaco Editor"),!1},showLoadError(o){const e=window.IDEI18n?window.IDEI18n.getMsg("cdn_load_error",`âŒ ${o} ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`):`âŒ ${o} ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`;window.IDEUtils&&window.IDEUtils.logToConsole?window.IDEUtils.logToConsole(e):(console.error(e),alert(e))},isOnline:()=>navigator.onLine,async testCdnLatency(o){try{const e=performance.now(),n=new AbortController,r=setTimeout(()=>n.abort(),5e3);return await fetch(o,{method:"HEAD",mode:"cors",signal:n.signal}),clearTimeout(r),Math.round(performance.now()-e)}catch{return-1}},async selectBestCdn(o){const e=this.cdnSources[o],n=[];console.log(`ğŸ” ${o} CDN ì‘ë‹µ ì‹œê°„ ì¸¡ì • ì¤‘...`);for(const r of e){const e="blockly"===o?`${r}/blockly_compressed.js`:`${r}/vs/loader.min.js`,c=await this.testCdnLatency(e);n.push({url:r,latency:c}),console.log(`  - ${r}: ${c>=0?c+"ms":"ì‹¤íŒ¨"}`)}const r=n.filter(o=>o.latency>=0);return 0===r.length?e[0]:(r.sort((o,e)=>o.latency-e.latency),console.log(`âœ… ìµœì  CDN ì„ íƒ: ${r[0].url} (${r[0].latency}ms)`),r[0].url)},reset(){this.loadedLibraries={blockly:!1,monacoLoader:!1,monacoCss:!1},this.currentCdnIndex={blockly:0,monaco:0}}},window.CDNLoader=window.CDNFallbackLoader,console.log("ğŸ“¦ CDN Fallback Loader ì´ˆê¸°í™” ì™„ë£Œ");